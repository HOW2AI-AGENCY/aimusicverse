# –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –¥–ª—è –°–ø—Ä–∏–Ω—Ç–∞ 010

**–°–ø—Ä–∏–Ω—Ç**: 010 - Homepage Discovery & AI Assistant (User Stories 5 & 6)  
**–ü–µ—Ä–∏–æ–¥**: 2026-01-12 - 2026-01-26 (2 –Ω–µ–¥–µ–ª–∏)  
**–¶–µ–ª—å**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø—É–±–ª–∏—á–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∏ AI Assistant —Ä–µ–∂–∏–º –¥–ª—è —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏

---

## üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–ø—Ä–∏–Ω—Ç–∞

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å**: 0% (0/37 –∑–∞–¥–∞—á)

- ‚è≥ **–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ**: 37 –∑–∞–¥–∞—á (25 –æ—Å–Ω–æ–≤–Ω—ã—Ö + 12 –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö)
- üîÑ **–í —Ä–∞–±–æ—Ç–µ**: 0 –∑–∞–¥–∞—á
- ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–æ**: 0 –∑–∞–¥–∞—á

---

## üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (User Stories)

### User Story 5: Homepage Discovery (P2)
**–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**, —è —Ö–æ—á—É –≤–∏–¥–µ—Ç—å –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –ø—É–±–ª–∏—á–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (Featured, New, Popular —Ç—Ä–µ–∫–∏), —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—É—é –º—É–∑—ã–∫—É –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞–º–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
1. ‚úÖ Homepage –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–∞–∑–¥–µ–ª—ã Featured/New/Popular
2. ‚úÖ –ö–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 10+ —Ç—Ä–µ–∫–æ–≤ —Å lazy loading
3. ‚úÖ –¢—Ä–µ–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã –∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
4. ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∏–ª—è–º –∏ —Ç–µ–≥–∞–º
5. ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –ø—É–±–ª–∏—á–Ω—ã–º —Ç—Ä–µ–∫–∞–º
6. ‚úÖ Infinite scroll –¥–ª—è –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π
7. ‚úÖ Skeleton loaders –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
8. ‚úÖ Performance: FCP <2s, Lighthouse >90

### User Story 6: AI Assistant Mode (P2)
**–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**, —è —Ö–æ—á—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI Assistant –≤ —Ñ–æ—Ä–º–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ-–∑–∞–≤–∏—Å–∏–º—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º—É–∑—ã–∫—É —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –æ—à–∏–±–æ–∫.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
1. ‚úÖ AI Assistant —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –≤ GenerateWizard
2. ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
3. ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è prompt –Ω–∞ –æ—Å–Ω–æ–≤–µ style
4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
5. ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è
6. ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∞
7. ‚úÖ Smart defaults –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìã –ó–∞–¥–∞—á–∏ –ø–æ –ß–µ–∫-–ª–∏—Å—Ç—É

### Phase 0: Infrastructure Prerequisites (CRITICAL - BLOCKING) ‚ö†Ô∏è

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï**: –≠—Ç–∏ –∑–∞–¥–∞—á–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∏—á–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–µ–¥–∏–∞-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

**Estimated**: 12 SP | **Duration**: 2-3 –¥–Ω—è | **Priority**: P0 (Highest)

- [ ] INF-010-001 [P] ‚úÖ Create storage buckets migration (tracks, covers, stems, uploads, avatars, banners, temp) - `20251203020000_create_storage_buckets.sql`
- [ ] INF-010-002 [P] ‚úÖ Create storage management tables (storage_usage, file_registry) - `20251203020001_create_storage_management.sql`
- [ ] INF-010-003 [P] ‚úÖ Create CDN integration tables (cdn_assets, media_processing_queue, asset_optimization_settings) - `20251203020002_create_cdn_media_cache.sql`
- [ ] INF-010-004 [P] ‚úÖ Create storage lifecycle management (cleanup, quotas, validation) - `20251203020003_create_storage_lifecycle.sql`
- [ ] INF-010-005 [P] Apply migrations to Supabase (run all 4 migration files)
- [ ] INF-010-006 [P] Test storage bucket upload/download with RLS policies
- [ ] INF-010-007 [P] Create helper functions in src/lib/storage.ts (uploadFile, deleteFile, getFileUrl)
- [ ] INF-010-008 [P] Create helper functions in src/lib/cdn.ts (getCDNUrl, getOptimizedImageUrl)
- [ ] INF-010-009 Setup CDN provider account (Cloudflare Images or Bunny CDN)
- [ ] INF-010-010 [P] Configure CDN environment variables in .env
- [ ] INF-010-011 [P] Update track upload flow to use new storage system (tracks bucket)
- [ ] INF-010-012 [P] Update cover upload to use covers bucket with automatic optimization

**Checkpoint**: Storage infrastructure –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º Phase 1

---

### Phase 1: Setup (Shared Infrastructure)

- [ ] T001 Create project structure for homepage and AI assistant features
- [ ] T002 [P] Setup database schema for public content (is_public, is_featured, likes_count, plays_count) - ‚úÖ Already in migration 20251202155000
- [ ] T003 [P] Setup database schema for AI assistant (prompt_suggestions table) - ‚úÖ Already in migration 20251202155001

---

### Phase 2: Foundational (Blocking Prerequisites)

- [ ] T004 Create usePublicTracks hook in src/hooks/usePublicTracks.ts for fetching public tracks with filters
- [ ] T005 [P] Create useAutocompleteSuggestions hook in src/hooks/useAutocompleteSuggestions.ts for AI suggestions
- [ ] T006 [P] Create AIAssistantContext provider in src/contexts/AIAssistantContext.tsx for global AI state

---

### Phase 3: User Story 5 - Homepage Discovery (Priority: P2) üéØ 

**Goal**: Implement public content discovery with Featured, New, and Popular sections

**Independent Test**: Navigate to homepage, verify all sections load, test search/filter, verify infinite scroll

#### Implementation for User Story 5

- [ ] T007 [P] [US5] Create Homepage layout component in src/pages/Homepage.tsx
- [ ] T008 [P] [US5] Create HeroSection component in src/components/homepage/HeroSection.tsx
- [ ] T009 [P] [US5] Create FeaturedSection component in src/components/homepage/FeaturedSection.tsx
- [ ] T010 [P] [US5] Create NewTracksSection component in src/components/homepage/NewTracksSection.tsx with infinite scroll
- [ ] T011 [P] [US5] Create PopularSection component in src/components/homepage/PopularSection.tsx with time range filter
- [ ] T012 [P] [US5] Create PublicTrackCard component in src/components/homepage/PublicTrackCard.tsx
- [ ] T013 [P] [US5] Create SearchBar component in src/components/homepage/SearchBar.tsx with debounce
- [ ] T014 [P] [US5] Create StyleFilter component in src/components/homepage/StyleFilter.tsx
- [ ] T015 [US5] Create backend public tracks API in supabase/functions/public-tracks/index.ts with caching
- [ ] T016 [US5] Add database indexes for public content queries (is_public, is_featured, likes_count)
- [ ] T017 [US5] Implement track likes system with track_likes table and triggers
- [ ] T018 [US5] Add analytics tracking for plays and views

**Checkpoint**: Homepage should display public content with search, filter, and infinite scroll working

---

### Phase 4: User Story 6 - AI Assistant Mode (Priority: P2)

**Goal**: Implement AI Assistant for guided music generation with smart suggestions

**Independent Test**: Open GenerateWizard, verify AI Assistant panel shows suggestions, test autocomplete, apply templates

#### Implementation for User Story 6

- [ ] T019 [P] [US6] Create AssistantPanel component in src/components/assistant/AssistantPanel.tsx
- [ ] T020 [P] [US6] Create SmartPromptInput component in src/components/assistant/SmartPromptInput.tsx with autocomplete
- [ ] T021 [P] [US6] Create StyleBasedSuggestions component in src/components/assistant/StyleBasedSuggestions.tsx
- [ ] T022 [P] [US6] Create ValidationFeedback component in src/components/assistant/ValidationFeedback.tsx
- [ ] T023 [P] [US6] Create TemplateLibrary component in src/components/assistant/TemplateLibrary.tsx with categories
- [ ] T024 [P] [US6] Create GenerationHistory component in src/components/assistant/GenerationHistory.tsx
- [ ] T025 [P] [US6] Create SmartDefaults component in src/components/assistant/SmartDefaults.tsx
- [ ] T026 [US6] Integrate AI Assistant into GenerateWizard in src/components/generate/GenerateWizard.tsx
- [ ] T027 [US6] Populate prompt_suggestions database with initial suggestions (277+ styles, common patterns)
- [ ] T028 [US6] Create AI Assistant settings page in src/components/settings/AIAssistantSettings.tsx
- [ ] T029 [US6] Add generation history tracking to database with user_generation_history table

**Checkpoint**: AI Assistant should provide suggestions, templates, and validation in GenerateWizard

---

### Phase 5: Polish & Cross-Cutting Concerns

- [ ] T030 [P] Add skeleton loaders for all homepage sections
- [ ] T031 [P] Optimize homepage performance (lazy loading, code splitting, image optimization)
- [ ] T032 [P] Add error boundaries and error states for homepage
- [ ] T033 [P] Add accessibility features (ARIA labels, keyboard navigation, screen reader support)
- [ ] T034 [P] Write E2E tests for homepage navigation and search in tests/e2e/homepage.spec.ts
- [ ] T035 [P] Write E2E tests for AI Assistant in tests/e2e/ai-assistant.spec.ts
- [ ] T036 Update documentation with homepage and AI assistant features

---

## Dependencies Between Tasks

**Critical Path**:
1. T002, T003 (Database) ‚Üí T004, T005, T006 (Hooks/Context) ‚Üí US5 & US6 Implementation
2. T004 (usePublicTracks) ‚Üí T007-T014 (Homepage components)
3. T005, T006 (AI Context) ‚Üí T019-T028 (AI Assistant components)
4. T026 (Integration) depends on T006, T019-T025

**Parallel Opportunities**:
- Homepage components (T007-T014) can be built in parallel after T004
- AI Assistant components (T019-T025) can be built in parallel after T005, T006
- Polish tasks (T030-T036) can run in parallel after core implementation

---

## Implementation Strategy

**Sprint Week 1 (Days 1-7)**:
- Days 1-2: Setup phase (T001-T003) + Foundational (T004-T006)
- Days 3-5: User Story 5 implementation (T007-T018)
- Days 6-7: Begin User Story 6 (T019-T023)

**Sprint Week 2 (Days 8-14)**:
- Days 8-10: Complete User Story 6 (T024-T029)
- Days 11-12: Polish & testing (T030-T036)
- Days 13-14: Code review, bug fixes, documentation

**MVP Scope**: User Story 5 (Homepage) can ship independently. User Story 6 (AI Assistant) is additive.

---

## Acceptance Criteria

### Functional Requirements
- [ ] Homepage displays Featured/New/Popular sections with proper data
- [ ] Search and style filtering work across all public tracks
- [ ] Infinite scroll loads more tracks smoothly
- [ ] AI Assistant provides contextual suggestions in GenerateWizard
- [ ] Template library offers quick-start options
- [ ] Generation history allows replay of previous generations
- [ ] All touch targets meet 44√ó44px minimum size
- [ ] All interactive elements have keyboard navigation

### Performance Requirements
- [ ] Homepage First Contentful Paint < 2s on 3G
- [ ] Lighthouse Mobile Score > 90
- [ ] Autocomplete latency < 300ms
- [ ] Infinite scroll smooth at 60fps
- [ ] Search debounce at 300ms prevents excessive API calls

### Quality Requirements
- [ ] TypeScript: 0 errors with strict mode
- [ ] ESLint: 0 new errors
- [ ] Prettier: all code formatted
- [ ] Code review completed and approved
- [ ] Test coverage > 80% for new code (optional)

---

## Testing Strategy

### Unit Tests (Optional - if requested)
- usePublicTracks hook with various filters
- useAutocompleteSuggestions with debouncing
- AIAssistantContext state management
- Component rendering and user interactions

### Integration Tests (Optional - if requested)
- Homepage sections loading and displaying data
- Search and filter integration
- AI Assistant integration with GenerateWizard
- Template application flow

### E2E Tests (Recommended)
- Homepage navigation and content discovery
- Public track search and filtering
- AI Assistant usage in music generation
- Template library and application
- Generation history replay

---

## Technical Notes

### Database Schema Changes
```sql
-- Public content support
ALTER TABLE tracks ADD COLUMN is_public BOOLEAN DEFAULT FALSE;
ALTER TABLE tracks ADD COLUMN is_featured BOOLEAN DEFAULT FALSE;
ALTER TABLE tracks ADD COLUMN likes_count INTEGER DEFAULT 0;
ALTER TABLE tracks ADD COLUMN plays_count INTEGER DEFAULT 0;

-- AI Assistant support
CREATE TABLE prompt_suggestions (
  id UUID PRIMARY KEY,
  text TEXT NOT NULL,
  description TEXT,
  category TEXT,
  style TEXT,
  usage_count INTEGER DEFAULT 0
);

CREATE TABLE track_likes (
  id UUID PRIMARY KEY,
  track_id UUID REFERENCES tracks(id),
  user_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(track_id, user_id)
);
```

### API Endpoints
- GET /api/public-tracks?filter=featured|new|popular&style=...&search=...
- GET /api/autocomplete?q=...&style=...&context=...
- POST /api/track/:id/like
- GET /api/generation-history?limit=20

### Performance Optimizations
- Implement virtual scrolling for large lists
- Use React.memo for expensive components
- Implement proper image lazy loading
- Cache autocomplete suggestions
- Use pagination for infinite scroll

---

## Risks & Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| Public content database performance | High | Add proper indexes, implement caching, use pagination |
| AI suggestion quality | Medium | Start with rule-based suggestions, gather user feedback, iterate |
| Autocomplete API rate limits | Medium | Implement aggressive caching, use local fallback suggestions |
| Homepage load time on slow networks | High | Optimize images, implement progressive loading, add service worker |

---

## Success Metrics

### User Story 5 (Homepage)
- Public content page views: > 1000/week
- Average time on homepage: > 2 minutes
- Search usage: > 30% of visitors
- Click-through rate on tracks: > 15%

### User Story 6 (AI Assistant)
- AI Assistant enabled rate: > 60% of generations
- Suggestion acceptance rate: > 40%
- Template usage: > 25% of users
- Generation success rate improvement: +20% vs baseline

---

## Next Steps

After Sprint 010, proceed to:
- **Sprint 011**: Social Features (User profiles, following, comments, collaboration)
- **Sprint 012**: Monetization (Credits, subscriptions, payment integration)
- **Sprint 013**: Advanced Audio (Stem editing, effects, waveform visualization)

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-12-02*
