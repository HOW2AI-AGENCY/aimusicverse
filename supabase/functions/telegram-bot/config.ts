// Import shared Telegram configuration
const getTelegramConfig = () => {
  const botUsername = Deno.env.get('TELEGRAM_BOT_USERNAME') || 'AIMusicVerseBot';
  const appShortName = Deno.env.get('TELEGRAM_APP_SHORT_NAME') || 'app';
  const miniAppUrl = Deno.env.get('MINI_APP_URL') || `https://t.me/${botUsername}/${appShortName}`;
  
  return {
    botUsername,
    appShortName,
    miniAppUrl,
    deepLinkBase: `https://t.me/${botUsername}/${appShortName}`,
  };
};

const telegramConfig = getTelegramConfig();

export const BOT_CONFIG = {
  botToken: Deno.env.get('TELEGRAM_BOT_TOKEN')!,
  botUsername: telegramConfig.botUsername,
  miniAppUrl: telegramConfig.miniAppUrl,
  deepLinkBase: telegramConfig.deepLinkBase,
  supabaseUrl: Deno.env.get('SUPABASE_URL')!,
  supabaseServiceKey: Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!,
};

export const MESSAGES = {
  welcome: `üéµ *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MusicVerse\\!*

–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –º—É–∑—ã–∫—É —Å –ø–æ–º–æ—â—å—é AI –ø—Ä—è–º–æ –≤ Telegram\\! üöÄ

*–ß—Ç–æ —è —É–º–µ—é:*
‚Ä¢ üéº –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–∫–æ–≤ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
‚Ä¢ üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ—Ç–æ–≤—ã—Ö —Ç—Ä–µ–∫–æ–≤ –≤ —á–∞—Ç
‚Ä¢ üë• –î–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –≤ –∏—Å—Ç–æ—Ä–∏—é
‚Ä¢ üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤–∞—à–∏—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–π
‚Ä¢ üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
‚Ä¢ üîî –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚Ä¢ üé® –≠–º–æ–¥–∑–∏ —Å—Ç–∞—Ç—É—Å—ã
‚Ä¢ ‚ö° –û–Ω–ª–∞–π–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

*–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:*
–û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ: "–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π —Ä–æ–∫ —Å –≥–∏—Ç–∞—Ä–æ–π"
–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ\\! üëá`,

  help: `üìö *–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º*

üéµ *–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:*
/generate \\<–æ–ø–∏—Å–∞–Ω–∏–µ\\> \\- –°–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫
/library \\- –ú–æ–∏ —Ç—Ä–µ–∫–∏ \\(–ø–æ—Å–ª–µ–¥–Ω–∏–µ 5\\)
/projects \\- –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã
/status \\- –°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
/app \\- –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

üé§ *–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ:*
/cover \\<–æ–ø–∏—Å–∞–Ω–∏–µ\\> \\- –°–æ–∑–¥–∞—Ç—å –∫–∞–≤–µ—Ä
/extend \\<–æ–ø–∏—Å–∞–Ω–∏–µ\\> \\- –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç—Ä–µ–∫
/audio \\- –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∞—É–¥–∏–æ
/cancel \\- –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É

üéº *–ü—Ä–∏–º–µ—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:*
‚Ä¢ /generate –º–µ–ª–æ–¥–∏—á–Ω—ã–π –ø–æ–ø —Ç—Ä–µ–∫ –æ –ª—é–±–≤–∏
‚Ä¢ /generate —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–π —Ä–æ–∫ —Å –≥–∏—Ç–∞—Ä–æ–π
‚Ä¢ /cover \\-\\-style\\="indie rock" –º–æ–π –∫–∞–≤–µ—Ä
‚Ä¢ /extend \\-\\-instrumental –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ

‚öôÔ∏è *–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:*
\\-\\-instrumental \\- –ë–µ–∑ –≤–æ–∫–∞–ª–∞
\\-\\-style\\="—Å—Ç–∏–ª—å" \\- –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
\\-\\-model v5 \\- –í–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏

üí° *–ü–æ–¥—Å–∫–∞–∑–∫–∞:* –ß–µ–º –¥–µ—Ç–∞–ª—å–Ω–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–µ–º –ª—É—á—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\\!`,

  generationStarted: 'üéº *–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å\\!*\n\n–í–∞—à —Ç—Ä–µ–∫ —Å–æ–∑–¥–∞—ë—Ç—Å—è\\.\\.\\. –û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 1\\-2 –º–∏–Ω—É—Ç—ã\\.\n–í—ã –ø–æ–ª—É—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ —Ç—Ä–µ–∫ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤\\! üîî',
  
  generationError: '‚ùå *–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏*\n\n–ß—Ç–æ\\-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫\\. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:\n‚Ä¢ –£–ø—Ä–æ—Å—Ç–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ\n‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã\n‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É',
  
  noTracks: 'üì≠ *–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç—Ä–µ–∫–æ–≤*\n\n–ù–∞—á–Ω–∏—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º—É–∑—ã–∫—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å\\!\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /generate <–æ–ø–∏—Å–∞–Ω–∏–µ> –∏–ª–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ üëá',
  
  noProjects: 'üì≠ *–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤*\n\n–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏\\!',

  trackReady: (title: string) => `üéâ *–í–∞—à —Ç—Ä–µ–∫ –≥–æ—Ç–æ–≤\\!*\n\nüéµ ${escapeMarkdown(title)}\n\n–°–ª—É—à–∞–π—Ç–µ –ø—Ä—è–º–æ –≤ Telegram –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞\\! üéß`,

  trackFailed: (error?: string) => `üòî *–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–µ–∫*\n\n${escapeMarkdown(error || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏')}\n\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ\\.`,

  processingStatus: (count: number) => `‚è≥ *–°—Ç–∞—Ç—É—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏*\n\n${count > 0 ? `–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á: ${count}\n–í–∞—à–∏ —Ç—Ä–µ–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è\\.\\.\\.` : '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏'}`,
};

// Helper function to escape MarkdownV2 special characters
// Security fix: Escape backslashes first to prevent incomplete sanitization
function escapeMarkdown(text: string): string {
  return text
    .replace(/\\/g, '\\\\')  // Escape backslashes first
    .replace(/([_*[\]()~`>#+\-=|{}.!])/g, '\\$1');  // Then escape other special chars
}
