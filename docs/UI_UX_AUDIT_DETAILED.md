# Детальный UX Аудит Интерфейса MusicVerse

## Дата: 2025-12-03
## Статус: В работе

---

## 1. Проблема: Резкая смена дизайна Waveform при загрузке

### 1.1 Текущее состояние
- **CompactPlayer.tsx (линии 148-177)**: При отсутствии waveformData отображается фоллбэк с рандомными барами
- Фоллбэк использует `Math.random()` и `Math.sin()` что создает статичные случайные бары
- Визуальная разница между фоллбэком и реальным waveform катастрофическая

### 1.2 Анализ User Journey
```
[Пользователь нажимает Play] 
    → [Появляется CompactPlayer с РАНДОМНЫМ фоллбэком]
    → [Через 0.5-2с загружается реальный waveform]
    → [РЕЗКАЯ ЗАМЕНА → Негативный UX]
```

### 1.3 Решение
**Вариант A (Рекомендуемый)**: Единый дизайн - простой progress bar
- Убрать рандомные бары
- Использовать простой animated progress bar до загрузки waveform
- Плавная анимация перехода через CSS fade

**Вариант B**: Skeleton с shimmer эффектом
- Показывать skeleton-loader вместо рандомных баров

### 1.4 Реализация
```tsx
// Единый минималистичный fallback
<div className="h-16 bg-muted/20 rounded relative overflow-hidden">
  <div className="absolute inset-y-0 left-0 bg-primary/30 transition-all"
       style={{ width: `${progress}%` }} />
  <div className="absolute inset-0 animate-shimmer" />
</div>
```

---

## 2. Проблема: Не работают интерактивные элементы карточки

### 2.1 Текущее состояние
- **TrackCard.tsx (линии 134-148)**: `handleCardClick` работает ТОЛЬКО на мобильных
- На десктопе клик по карточке ничего не делает
- Like кнопка (линии 477-489) работает корректно при наличии `onToggleLike`
- **Library.tsx передает все нужные props** (линии 272-285)

### 2.2 Найденная проблема
При использовании `motion.div` с `drag` (линия 290) события клика могут перехватываться.
Также `e.stopPropagation()` на многих элементах блокирует всплытие.

### 2.3 Анализ обработчиков событий
```
TrackCard onClick → handleCardClick
  ├─ Проверяет: target.closest('button') → НЕ СРАБАТЫВАЕТ если кнопка
  ├─ Проверяет: target.closest('[data-play-button]') → НЕ СРАБАТЫВАЕТ
  └─ isMobile ? setSheetOpen(true) : НИЧЕГО (!)
```

**КРИТИЧЕСКАЯ ОШИБКА**: На десктопе клик по карточке не открывает ничего!

### 2.4 Решение
1. Добавить открытие TrackDetailsSheet на десктопе при клике по карточке
2. Исправить обработку событий в drag gesture

---

## 3. Проблема: Не отображается система версионирования

### 3.1 Текущее состояние
- **VersionBadge.tsx**: Компонент существует и корректен
- **TrackCard.tsx (линии 418-430)**: Бейдж показывается ТОЛЬКО если `versionCount > 0`
- **useEffect (линии 60-74)**: Запрос версий выполняется асинхронно

### 3.2 Диагностика
Версии загружаются, но:
1. Запрос может возвращать 0 если нет записей в `track_versions`
2. `is_primary` может быть не установлен

### 3.3 Решение
1. Проверить наличие данных в таблице `track_versions`
2. Добавить индикатор даже для 1 версии
3. Улучшить визуальную заметность бейджа

---

## 4. Проблема: Полноэкранный плеер на мобильных устройствах

### 4.1 Текущее состояние (FullscreenPlayer.tsx)
- Использует grid layout: `grid-cols-1 lg:grid-cols-2`
- На мобильных всё в одну колонку, лирика скрыта за скроллом
- Volume control занимает место, хотя на мобильных не нужен
- ProgressBar не очевиден как timeline

### 4.2 Проблемы UX на мобильных
1. **Обложка слишком большая** - занимает много места
2. **Лирика не видна** - нужно скроллить
3. **Кнопки мелкие** - не соответствуют touch targets
4. **Непонятный UI** - slider выглядит как volume, не как timeline

### 4.3 Решение: Новый мобильный дизайн

```
┌─────────────────────────────────────┐
│ [Cover с blur] (полноэкранный фон)  │
│                                     │
│    ═══════════════════════════      │  
│    Синхронизированная лирика        │
│    с подсветкой активных слов       │
│    ═══════════════════════════      │
│                                     │
│  ─────────────────────────────────  │ ← Timeline
│  0:32 ═══════════●────────── 3:45   │
│                                     │
│     [⏮️]    [⏯️]    [⏭️]          │ ← Большие кнопки
│                                     │
│  [❤️]  [📋]  [⬇️]  [📤]  [✖️]      │ ← Actions
└─────────────────────────────────────┘
```

### 4.4 Ключевые изменения
1. **Фон**: Blur обложки + затемнение
2. **Лирика**: Центр экрана, крупный текст, подсветка слов
3. **Controls**: Внизу, крупные touch targets (min 44x44)
4. **Timeline**: Четкая визуализация с временем

---

## 5. Система синхронизированной лирики

### 5.1 Текущее состояние
- **FullscreenPlayer.tsx (линии 318-350)**: Лирика работает с alignedWords
- Auto-scroll реализован
- Подсветка активной строки есть

### 5.2 Улучшения
1. Подсветка на уровне СЛОВ, не строк
2. Плавный scroll с offset
3. Tap по слову = seek к этому времени
4. Караоке-эффект (заливка слова по мере воспроизведения)

---

## 6. План реализации

### Sprint 1 (Критические исправления)
- [ ] **FIX-1**: Унифицировать fallback waveform
- [ ] **FIX-2**: Исправить клики по карточке на десктопе  
- [ ] **FIX-3**: Добавить отладку версионирования

### Sprint 2 (Мобильный редизайн)
- [ ] **DESIGN-1**: Редизайн FullscreenPlayer для mobile
- [ ] **DESIGN-2**: Blur фон с лирикой
- [ ] **DESIGN-3**: Улучшенная синхронизация слов

### Sprint 3 (Polish)
- [ ] **POLISH-1**: Анимации переходов
- [ ] **POLISH-2**: Haptic feedback
- [ ] **POLISH-3**: Accessibility audit

---

## Детальные wireframes

### Mobile Fullscreen Player

```
┌─────────────────────────────────────┐
│ [X close]              [⋮ menu]    │ ← Header (полупрозрачный)
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │   [Blurred album cover]     │   │ ← Фон: blur(20px) + 
│  │   (full screen background)   │   │   черный overlay 50%
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│        "Слова которые уже"          │ ← Прошедший текст (opacity: 0.5)
│                                     │
│      ▶ "АКТИВНОЕ СЛОВО" ◀          │ ← Текущее (primary, scale 1.1)
│                                     │
│        "Следующие слова"            │ ← Будущий текст (opacity: 0.7)
│                                     │
│  ═══════════════════════════════   │
│  0:32 ═══════════●────────── 3:45  │ ← Timeline
│                                     │
│      [⏮️]    [⏯️ 64px]    [⏭️]     │ ← Controls (44px+ touch)
│                                     │
│  [❤️]   [🔀]   [🔁]   [📥]   [📤]  │ ← Secondary actions
│                                     │
│  ▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀▀  │ ← Safe area
└─────────────────────────────────────┘
```

### Desktop Fullscreen Player (без изменений)
Текущий двухколоночный layout сохраняется для desktop.

---

## Технические требования

### Компоненты для создания/изменения

1. **MobileFullscreenPlayer.tsx** (новый)
   - Отдельный компонент для mobile fullscreen
   - Использует useIsMobile() для определения устройства

2. **BlurredCoverBackground.tsx** (новый)
   - CSS backdrop-filter: blur(20px)
   - Gradient overlay для контраста

3. **SyncedLyricsDisplay.tsx** (новый)
   - Word-level синхронизация
   - Автоскролл с центрированием
   - Tap-to-seek

4. **Изменения в существующих файлах**:
   - CompactPlayer.tsx: унифицированный fallback
   - TrackCard.tsx: исправление обработчиков событий
   - FullscreenPlayer.tsx: условный рендер mobile/desktop

---

## Метрики успеха

- [ ] Нет визуального "прыжка" при загрузке waveform
- [ ] Все интерактивные элементы карточки работают
- [ ] Версионирование видно на всех треках с версиями
- [ ] Mobile fullscreen проходит тест юзабилити
- [ ] Лирика синхронизирована на уровне слов
