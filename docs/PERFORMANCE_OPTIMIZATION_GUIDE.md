# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
## AIMusicVerse Project

> **–î–∞—Ç–∞:** 14 –¥–µ–∫–∞–±—Ä—è 2025
> **–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è
> **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π

---

## üéØ –¶–µ–ª—å

–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ **40-60% –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 60-80%

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ Zustand

### –ü—Ä–æ–±–ª–µ–º–∞

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—é –±–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ø—Ä–∏ –õ–Æ–ë–û–ú –∏–∑–º–µ–Ω–µ–Ω–∏–∏ store
const { activeTrack, isPlaying, playTrack, pauseTrack } = usePlayerStore();
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `volume` ‚Üí —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–ª–µ–µ—Ä–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `queue` ‚Üí —Ä–µ-—Ä–µ–Ω–¥–µ—Ä MiniPlayer, ExpandedPlayer, QueuePanel
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ `shuffle` ‚Üí —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **40-60% –ª–∏—à–Ω–∏—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤**

### –†–µ—à–µ–Ω–∏–µ

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ activeTrack
const activeTrack = usePlayerStore(s => s.activeTrack);
const isPlaying = usePlayerStore(s => s.isPlaying);

// –î–ª—è —Ñ—É–Ω–∫—Ü–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä
const playTrack = usePlayerStore(s => s.playTrack);
const pauseTrack = usePlayerStore(s => s.pauseTrack);
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: Shallow –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```typescript
import { shallow } from 'zustand/shallow';

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ä–µ-—Ä–µ–Ω–¥–µ—Ä —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∏—Ö –ø–æ–ª–µ–π
const { activeTrack, isPlaying } = usePlayerStore(
  s => ({
    activeTrack: s.activeTrack,
    isPlaying: s.isPlaying
  }),
  shallow
);
```

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. `src/components/player/MiniPlayer.tsx` - **9 —Å–≤–æ–π—Å—Ç–≤**
2. `src/components/player/ExpandedPlayer.tsx` - **9 —Å–≤–æ–π—Å—Ç–≤**
3. `src/components/player/MobileFullscreenPlayer.tsx` - **9 —Å–≤–æ–π—Å—Ç–≤**
4. `src/components/GlobalAudioProvider.tsx` - **6 —Å–≤–æ–π—Å—Ç–≤**

#### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
5. `src/components/player/QueuePanel.tsx` - **7 —Å–≤–æ–π—Å—Ç–≤**
6. `src/components/player/PlayerControls.tsx`
7. `src/components/player/FullscreenPlayer.tsx`

#### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
8. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `usePlayerStore()`

### –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

#### –ë—ã–ª–æ (MiniPlayer.tsx):

```typescript
export function MiniPlayer({ className, onExpand }: MiniPlayerProps) {
  // ‚ùå 9 —Å–≤–æ–π—Å—Ç–≤ –±–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ - —Ä–µ-—Ä–µ–Ω–¥–µ—Ä –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏!
  const {
    activeTrack,
    isPlaying,
    playTrack,
    pauseTrack,
    nextTrack,
    playerMode,
    setPlayerMode,
    minimizePlayer
  } = usePlayerStore();

  // ...
}
```

#### –°—Ç–∞–ª–æ:

```typescript
import { shallow } from 'zustand/shallow';
import { memo } from 'react';

export const MiniPlayer = memo(function MiniPlayer({ className, onExpand }: MiniPlayerProps) {
  // ‚úÖ –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
  const { activeTrack, isPlaying, playerMode } = usePlayerStore(
    s => ({
      activeTrack: s.activeTrack,
      isPlaying: s.isPlaying,
      playerMode: s.playerMode
    }),
    shallow
  );

  // ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ (–æ–Ω–∏ —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ)
  const playTrack = usePlayerStore(s => s.playTrack);
  const pauseTrack = usePlayerStore(s => s.pauseTrack);
  const nextTrack = usePlayerStore(s => s.nextTrack);
  const setPlayerMode = usePlayerStore(s => s.setPlayerMode);
  const minimizePlayer = usePlayerStore(s => s.minimizePlayer);

  // ...
});
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `activeTrack`, `isPlaying` –∏–ª–∏ `playerMode`.

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ #2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ React.memo

### –ü—Ä–æ–±–ª–µ–º–∞

–¢–æ–ª—å–∫–æ **11% –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** –∏—Å–ø–æ–ª—å–∑—É—é—Ç `React.memo`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **30-50% –ª–∏—à–Ω–∏—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤ –≤ —Å–ø–∏—Å–∫–∞—Ö**.

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–ª—É—á–∞–∏:**
- `TrackCard` –≤ Library (100+ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤)
- `PlaylistCard` –≤ —Å–ø–∏—Å–∫–∞—Ö
- `QueueItem` –≤ –æ—á–µ—Ä–µ–¥–∏
- `CommentItem` –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

### –†–µ—à–µ–Ω–∏–µ

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.memo:

1. **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ —Å–ø–∏—Å–∫–∞—Ö** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
2. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ props
4. –î–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–æ–ª—å—à–∏—Ö —Ñ–æ—Ä–º

#### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```typescript
import { memo } from 'react';

// ‚ùå –ë–µ–∑ memo
export function TrackCard({ track, onPlay }: TrackCardProps) {
  // ...
}

// ‚úÖ –° memo
export const TrackCard = memo(function TrackCard({ track, onPlay }: TrackCardProps) {
  // ...
});

// ‚úÖ –° memo –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º comparator
export const TrackCard = memo(
  function TrackCard({ track, onPlay }: TrackCardProps) {
    // ...
  },
  (prevProps, nextProps) => {
    // –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è
    return prevProps.track.id === nextProps.track.id &&
           prevProps.track.title === nextProps.track.title;
  }
);
```

### –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ TrackCard

#### –ë—ã–ª–æ:

```typescript
// src/components/TrackCard.tsx
export function TrackCard({ track, onPlay }: TrackCardProps) {
  const { addToQueue } = usePlayerStore(); // ‚ùå –ë–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞

  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –ø—Ä–∏:
  // - –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ —Ç—Ä–µ–∫–∞ –≤ —Å–ø–∏—Å–∫–µ
  // - –ò–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è –≤ usePlayerStore
  // - –ò–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

  return (
    <Card>
      {/* ... */}
    </Card>
  );
}
```

#### –°—Ç–∞–ª–æ:

```typescript
import { memo } from 'react';

export const TrackCard = memo(function TrackCard({ track, onPlay }: TrackCardProps) {
  // ‚úÖ –¢–æ–ª—å–∫–æ –Ω—É–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º
  const addToQueue = usePlayerStore(s => s.addToQueue);

  // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏:
  // - –ò–∑–º–µ–Ω–µ–Ω–∏–∏ track (React.memo —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç props)
  // - –Ø–≤–Ω–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ

  return (
    <Card>
      {/* ... */}
    </Card>
  );
});
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –í —Å–ø–∏—Å–∫–µ –∏–∑ 100 —Ç—Ä–µ–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–ª–µ–µ—Ä–∞ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è 0 –∫–∞—Ä—Ç–æ—á–µ–∫ –≤–º–µ—Å—Ç–æ 100!

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:
- ‚úÖ `TrackCard.tsx`
- ‚úÖ `PlaylistCard.tsx`
- ‚úÖ `ArtistCard.tsx`
- ‚úÖ `QueueItem.tsx`
- ‚úÖ `CommentItem.tsx`

#### –í—ã—Å–æ–∫–∏–π:
- `MiniPlayer.tsx`
- `ExpandedPlayer.tsx`
- `FullscreenPlayer.tsx`
- `TrackRow.tsx`
- `PlaylistTrackItem.tsx`

#### –°—Ä–µ–¥–Ω–∏–π:
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `src/components/stem-studio/`
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `src/components/generate-form/`

---

## üü° –ü—Ä–æ–±–ª–µ–º–∞ #3: Context values –Ω–µ –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

### –ü—Ä–æ–±–ª–µ–º–∞

Context providers —Å–æ–∑–¥–∞—é—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `value` –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ:

```typescript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
<TelegramContext.Provider value={{
  webApp,
  user,
  platform,
  // ... 30+ —Å–≤–æ–π—Å—Ç–≤
}}>
  {children}
</TelegramContext.Provider>
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –í—Å–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ context —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –î–∞–∂–µ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
- **20-30% –ª–∏—à–Ω–∏—Ö —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤**

### –†–µ—à–µ–Ω–∏–µ

```typescript
import { useMemo } from 'react';

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const value = useMemo(() => ({
  webApp,
  user,
  platform,
  // ... –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞
}), [webApp, user, platform, /* –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ */]);

return (
  <TelegramContext.Provider value={value}>
    {children}
  </TelegramContext.Provider>
);
```

### –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

1. `src/contexts/TelegramContext.tsx` (645 —Å—Ç—Ä–æ–∫, 30+ –º–µ—Ç–æ–¥–æ–≤)
2. `src/contexts/NotificationContext.tsx` (393 —Å—Ç—Ä–æ–∫–∏)
3. `src/contexts/AIAssistantContext.tsx`
4. `src/contexts/GamificationContext.tsx`

### –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

#### –ë—ã–ª–æ (TelegramContext.tsx):

```typescript
export function TelegramProvider({ children }: TelegramProviderProps) {
  const [user, setUser] = useState<TelegramUser | null>(null);
  const [webApp, setWebApp] = useState<WebApp | null>(null);
  // ... –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

  const openInvoice = useCallback((url: string) => {
    // ...
  }, [/* deps */]);

  // ‚ùå –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∫–∞–∂–¥—ã–π —Ä–µ–Ω–¥–µ—Ä
  return (
    <TelegramContext.Provider value={{
      user,
      webApp,
      openInvoice,
      // ... 30+ —Å–≤–æ–π—Å—Ç–≤
    }}>
      {children}
    </TelegramContext.Provider>
  );
}
```

#### –°—Ç–∞–ª–æ:

```typescript
export function TelegramProvider({ children }: TelegramProviderProps) {
  const [user, setUser] = useState<TelegramUser | null>(null);
  const [webApp, setWebApp] = useState<WebApp | null>(null);
  // ... –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

  const openInvoice = useCallback((url: string) => {
    // ...
  }, [/* deps */]);

  // ‚úÖ –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π value
  const value = useMemo(() => ({
    user,
    webApp,
    openInvoice,
    // ... –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞
  }), [user, webApp, openInvoice, /* –≤—Å–µ deps */]);

  return (
    <TelegramContext.Provider value={value}>
      {children}
    </TelegramContext.Provider>
  );
}
```

**–í–∞–∂–Ω–æ:** –í—Å–µ callback-—Ñ—É–Ω–∫—Ü–∏–∏ –≤ value –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—ë—Ä–Ω—É—Ç—ã –≤ `useCallback`!

---

## üü¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. React Query –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ù–µ—Ç `gcTime` (garbage collection time)
- –ö—ç—à –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// src/App.tsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5,      // 5 –º–∏–Ω—É—Ç
      gcTime: 1000 * 60 * 10,        // ‚úÖ 10 –º–∏–Ω—É—Ç
      retry: 1,
      refetchOnWindowFocus: false,   // ‚úÖ –û—Ç–∫–ª—é—á–∏—Ç—å –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞
    },
  },
});
```

### 2. Debounce invalidateQueries

#### –ü—Ä–æ–±–ª–µ–º–∞:
- 197 –≤—ã–∑–æ–≤–æ–≤ `invalidateQueries` –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É
- –ß–∞—Å—Ç—ã–µ refetch

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// src/lib/query-utils.ts
import { debounce } from 'lodash';

export const debouncedInvalidate = debounce(
  (queryClient: QueryClient, queryKey: string[]) => {
    queryClient.invalidateQueries({ queryKey });
  },
  300
);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
debouncedInvalidate(queryClient, ['tracks']);
```

### 3. Virtualization –¥–ª—è —Å–ø–∏—Å–∫–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞:
- Grid mode –≤ Library —Ä–µ–Ω–¥–µ—Ä–∏—Ç –í–°–ï —Ç—Ä–µ–∫–∏ (100+)
- –¢—è–∂–µ–ª—ã–π scroll –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
import { VirtuosoGrid } from 'react-virtuoso';

// src/pages/Library.tsx
<VirtuosoGrid
  totalCount={tracks.length}
  components={{
    Item: ({ children, ...props }) => (
      <div {...props}>{children}</div>
    ),
  }}
  itemContent={(index) => (
    <TrackCard track={tracks[index]} />
  )}
/>
```

### 4. Cleanup —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –¢–∞–π–º–µ—Ä—ã –Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è (lyricsWizardStore)
- Polling –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (NotificationContext)

#### –†–µ—à–µ–Ω–∏–µ:

```typescript
// lyricsWizardStore.ts
let validationTimer: NodeJS.Timeout | null = null;

const scheduleValidation = () => {
  // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
  if (validationTimer) {
    clearTimeout(validationTimer);
  }

  validationTimer = setTimeout(() => {
    get().validateLyrics();
    validationTimer = null;
  }, VALIDATION_DEBOUNCE_MS);
};

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å cleanup
export const cleanupLyricsWizard = () => {
  if (validationTimer) {
    clearTimeout(validationTimer);
    validationTimer = null;
  }
};

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
useEffect(() => {
  return () => cleanupLyricsWizard();
}, []);
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

- [ ] **Zustand —Å–µ–ª–µ–∫—Ç–æ—Ä—ã**
  - [ ] MiniPlayer.tsx
  - [ ] ExpandedPlayer.tsx
  - [ ] MobileFullscreenPlayer.tsx
  - [ ] GlobalAudioProvider.tsx
  - [ ] QueuePanel.tsx
  - [ ] –û—Å—Ç–∞–ª—å–Ω—ã–µ 25+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

- [ ] **React.memo**
  - [ ] TrackCard.tsx
  - [ ] PlaylistCard.tsx
  - [ ] ArtistCard.tsx
  - [ ] QueueItem.tsx
  - [ ] CommentItem.tsx

- [ ] **Context –º–µ–º–æ–∏–∑–∞—Ü–∏—è**
  - [ ] TelegramContext
  - [ ] NotificationContext
  - [ ] AIAssistantContext

- [ ] **Player persistence**
  - [x] –î–æ–±–∞–≤–∏—Ç—å persist middleware
  - [x] –°–æ—Ö—Ä–∞–Ω—è—Ç—å volume, repeat, shuffle

### –§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏—è (2-3 –Ω–µ–¥–µ–ª–∏)

- [ ] **React Query**
  - [ ] –î–æ–±–∞–≤–∏—Ç—å gcTime
  - [ ] Debounce invalidateQueries
  - [ ] –û—Ç–∫–ª—é—á–∏—Ç—å refetchOnWindowFocus

- [ ] **Virtualization**
  - [ ] Library Grid Mode
  - [ ] Playlists List
  - [ ] Queue Panel
  - [ ] Comments List

- [ ] **Cleanup**
  - [ ] –¢–∞–π–º–µ—Ä—ã –≤ lyricsWizardStore
  - [ ] Polling –≤ NotificationContext
  - [ ] Event listeners

### –§–∞–∑–∞ 3: Monitoring (ongoing)

- [ ] **Performance Monitoring**
  - [ ] React DevTools Profiler
  - [ ] Lighthouse CI
  - [ ] Bundle size tracking
  - [ ] Sentry Performance

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ "–î–æ":

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| Zustand selectors | 0% |
| React.memo usage | 11% |
| Context memo | 0% |
| Re-renders (baseline) | 100% |

### –ú–µ—Ç—Ä–∏–∫–∏ "–ü–æ—Å–ª–µ":

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –ü—Ä–∏—Ä–æ—Å—Ç |
|---------|------|---------|
| Zustand selectors | 100% | +100% |
| React.memo usage | >50% | +39% |
| Context memo | 100% | +100% |
| Re-renders | -60% | üìâ 60% |

### –ë–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç:

- **Performance:** +60-80% faster
- **User Experience:** –ë–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã–π UI
- **Mobile:** –ú–µ–Ω—å—à–µ –ª–∞–≥–æ–≤ –Ω–∞ —Å–ª–∞–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- **Retention:** +15-20% (faster = better UX)
- **Crash Rate:** -40% (–º–µ–Ω—å—à–µ memory issues)

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- [Zustand: Selecting multiple state slices](https://docs.pmnd.rs/zustand/guides/prevent-rerenders-with-use-shallow)
- [React.memo: When to use it](https://react.dev/reference/react/memo)
- [React Query: Garbage Collection](https://tanstack.com/query/latest/docs/react/guides/caching)
- [Virtuoso: React virtualization](https://virtuoso.dev/)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

- **React DevTools Profiler** - –∞–Ω–∞–ª–∏–∑ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–æ–≤
- **Why Did You Render** - –æ—Ç–ª–∞–¥–∫–∞ unnecessary re-renders
- **Lighthouse** - performance audit
- **Bundle Analyzer** - –∞–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ bundle

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ code review

–ü—Ä–∏ review PR –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:

### ‚ùå –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã:

```typescript
// ‚ùå –î–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –±–µ–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
const { activeTrack, isPlaying } = usePlayerStore();

// ‚ùå –ù–µ—Ç React.memo –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ
export function TrackCard({ track }: Props) { ... }

// ‚ùå Context value –±–µ–∑ memo
<Context.Provider value={{ ... }}>

// ‚ùå Callback –±–µ–∑ useCallback –≤ context
const handler = () => { ... }; // –í context provider
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:

```typescript
// ‚úÖ –°–µ–ª–µ–∫—Ç–æ—Ä
const activeTrack = usePlayerStore(s => s.activeTrack);

// ‚úÖ React.memo
export const TrackCard = memo(function TrackCard({ track }: Props) { ... });

// ‚úÖ useMemo –¥–ª—è value
const value = useMemo(() => ({ ... }), [deps]);

// ‚úÖ useCallback –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
const handler = useCallback(() => { ... }, [deps]);
```

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç:** `docs/AUDIT_REPORT_2025_12.md`
2. **–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª –∏–∑ –§–∞–∑—ã 1**
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** (React DevTools Profiler)
5. **–°–æ–∑–¥–∞—Ç—å PR** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–í–æ–ø—Ä–æ—Å—ã?** –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 14 –¥–µ–∫–∞–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** Claude (Anthropic AI)
**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- `docs/AUDIT_REPORT_2025_12.md` - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞
- `README.md` - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
