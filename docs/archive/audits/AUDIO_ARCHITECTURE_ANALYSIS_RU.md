# –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞—É–¥–∏–æ-–ª–æ–≥–∏–∫–∏ MusicVerse AI

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 9 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–Ø–∑—ã–∫:** –†—É—Å—Å–∫–∏–π

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∞—É–¥–∏–æ-–ø–ª–µ–µ—Ä](#–≥–ª–æ–±–∞–ª—å–Ω—ã–π-–∞—É–¥–∏–æ-–ø–ª–µ–µ—Ä)
3. [–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–æ—á–µ—Ä–µ–¥–∏-–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è)
4. [Stem Studio: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—É–¥–∏–æ-–æ–±—Ä–∞–±–æ—Ç–∫–∞](#stem-studio-–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è-–∞—É–¥–∏–æ-–æ–±—Ä–∞–±–æ—Ç–∫–∞)
5. [–ê—É–¥–∏–æ-—ç—Ñ—Ñ–µ–∫—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞](#–∞—É–¥–∏–æ-—ç—Ñ—Ñ–µ–∫—Ç—ã-–∏-–æ–±—Ä–∞–±–æ—Ç–∫–∞)
6. [–≠–∫—Å–ø–æ—Ä—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤](#—ç–∫—Å–ø–æ—Ä—Ç-–∏-—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
7. [–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ](#–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è-–∞—É–¥–∏–æ)
8. [–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π —Ç—Ä–µ–∫–æ–≤](#—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-—Å–µ–∫—Ü–∏–π-—Ç—Ä–µ–∫–æ–≤)
9. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–æ—Å—Ç–æ—è–Ω–∏–µ–º)
10. [–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ—Ç–æ–∫–∏-–¥–∞–Ω–Ω—ã—Ö)
11. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

---

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

MusicVerse AI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–æ –Ω–∞ React 19 + TypeScript 5 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Vite –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ Zustand –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–ª–µ–µ—Ä** (singleton Audio Element)
- **–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π** —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é
- **Stem Studio** –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **Web Audio API** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- **Offline Audio Context** –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
- **WaveSurfer.js** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

---

## –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∞—É–¥–∏–æ-–ø–ª–µ–µ—Ä

### üìÅ –§–∞–π–ª: `src/hooks/audio/useGlobalAudioPlayer.ts`

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω **Singleton** –¥–ª—è –µ–¥–∏–Ω–æ–≥–æ –∞—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç–∞.


### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–ª–µ–µ—Ä–∞:

#### 1. Singleton Audio Element
```typescript
let globalAudioElement: HTMLAudioElement | null = null;

function getGlobalAudio(): HTMLAudioElement {
  if (!globalAudioElement) {
    globalAudioElement = new Audio();
    globalAudioElement.preload = 'metadata';
  }
  return globalAudioElement;
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –û–¥–∏–Ω –∞—É–¥–∏–æ-—ç–ª–µ–º–µ–Ω—Ç –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Üí –º–µ–Ω—å—à–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
- –ò–∑–±–µ–≥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏

#### 2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
```typescript
const getAudioSource = () => {
  return activeTrack.streaming_url ||    // 1. CDN (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ)
         activeTrack.local_audio_url ||  // 2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à (fallback)
         activeTrack.audio_url;          // 3. –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL (last resort)
}
```

#### 3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- `ended` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ç—Ä–µ–∫—É –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä
- `error` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Zustand store –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

#### 4. API –ø–ª–µ–µ—Ä–∞
```typescript
{
  seek: (time: number) => void,           // –ü–µ—Ä–µ–º–æ—Ç–∫–∞
  setVolume: (volume: number) => void,    // –ì—Ä–æ–º–∫–æ—Å—Ç—å (0-1)
  getCurrentTime: () => number,           // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è
  getDuration: () => number,              // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
  getBuffered: () => number,              // % –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
  audioElement: HTMLAudioElement          // –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
}
```

---

## –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

### üìÅ –§–∞–π–ª: `src/hooks/audio/usePlaybackQueue.ts`

–ú–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é —Å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é** –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π shuffle/repeat.

### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–æ–≤
```typescript
addTrack(track, playNow: boolean)  // –û–¥–∏–Ω —Ç—Ä–µ–∫
addTracks(tracks, playFirst)        // Batch –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
setQueue(tracks, startIndex)        // –ó–∞–º–µ–Ω–∞ –æ—á–µ—Ä–µ–¥–∏
```

**–õ–æ–≥–∏–∫–∞ `playNow`:**
- `true` ‚Üí —Ç—Ä–µ–∫ –≤ –Ω–∞—á–∞–ª–æ, —Å—Ä–∞–∑—É –∏–≥—Ä–∞–µ—Ç
- `false` ‚Üí —Ç—Ä–µ–∫ –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏

#### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–æ–º
```typescript
removeTrack(index)              // –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–µ—Ä–µ—Å—á—ë—Ç–æ–º –∏–Ω–¥–µ–∫—Å–∞
reorder(fromIndex, toIndex)     // Drag & drop
jumpToTrack(index)              // –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥
```

**–£–º–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:**
```typescript
if (index < currentIndex) {
  newCurrentIndex = currentIndex - 1;
} else if (index === currentIndex) {
  // –¢–µ–∫—É—â–∏–π —É–¥–∞–ª—ë–Ω ‚Üí –∏–≥—Ä–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π
  activeTrack = newQueue[currentIndex];
}
```

#### 3. –†–µ–∂–∏–º—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

**Shuffle:**
```typescript
toggleShuffleMode() {
  if (newShuffleState) {
    const shuffled = shuffleQueue(queue, currentIndex);
    setState({ queue: shuffled, currentIndex: 0 });
  }
}
```

**Repeat Modes:**
- `off` ‚Üí –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –∫–æ–Ω—Ü–µ
- `all` ‚Üí —Ü–∏–∫–ª –≤—Å–µ–π –æ—á–µ—Ä–µ–¥–∏
- `one` ‚Üí –ø–æ–≤—Ç–æ—Ä —Ç—Ä–µ–∫–∞

#### 4. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å localStorage

**–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**
```typescript
// 1. –û—á–µ—Ä–µ–¥—å —Ç—Ä–µ–∫–æ–≤
localStorage.setItem('musicverse-playback-queue', JSON.stringify(queue));

// 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ (–∫—Ä–∏—Ç–∏—á–Ω–æ–µ)
localStorage.setItem('musicverse-queue-state', JSON.stringify({
  currentIndex, shuffle, repeat
}));
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- `QuotaExceededError` ‚Üí silent fail —Å warning
- `SecurityError` (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ä–µ–∂–∏–º) ‚Üí –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏

---

## Stem Studio: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—É–¥–∏–æ-–æ–±—Ä–∞–±–æ—Ç–∫–∞

### üìÅ –§–∞–π–ª—ã: 
- `src/hooks/studio/useStemStudioEngine.ts` - –º—É–ª—å—Ç–∏-—Å—Ç–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä
- `src/hooks/studio/useStemAudioEngine.ts` - single stem engine
- `src/components/stem-studio/StemStudioContent.tsx` - UI

Stem Studio - **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–Ω–æ–≥–æ–¥–æ—Ä–æ–∂–µ—á–Ω—ã–π –∞—É–¥–∏–æ-—Ä–µ–¥–∞–∫—Ç–æ—Ä** —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

### Web Audio API –≥—Ä–∞—Ñ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–µ–º–∞:

```
Source (MediaElement) 
    ‚Üì
Gain Node (Volume)
    ‚Üì
EQ Chain:
  - Low Shelf (320 Hz)
  - Mid Peaking (1000 Hz)
  - High Shelf (3200 Hz)
    ‚Üì
Compressor (DynamicsCompressor)
    ‚Üì
Parallel Routing:
  ‚îú‚îÄ‚Üí Dry Gain ‚îÄ‚Üí Output
  ‚îî‚îÄ‚Üí Convolver (Reverb) ‚Üí Wet Gain ‚Üí Output
    ‚Üì
Master Gain (Shared)
    ‚Üì
Destination (Speakers)
```

### API Stem Studio:

```typescript
const {
  enginesState,           // –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–µ–º–æ–≤
  isInitialized,          // –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
  initializeStemEngine,   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–µ–º–∞
  updateStemEQ,           // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ EQ
  updateStemCompressor,   // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø—Ä–µ—Å—Å–æ—Ä–∞
  updateStemReverb,       // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏–∏
  applyStemEQPreset,      // –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–µ—Å–µ—Ç EQ
  resetStemEffects,       // –°–±—Ä–æ—Å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  setStemVolume,          // –ì—Ä–æ–º–∫–æ—Å—Ç—å —Å—Ç–µ–º–∞
  setMasterVolume,        // –ú–∞—Å—Ç–µ—Ä –≥—Ä–æ–º–∫–æ—Å—Ç—å
} = useStemStudioEngine(stemIds);
```

### –≠—Ñ—Ñ–µ–∫—Ç—ã:

#### EQ (3-–ø–æ–ª–æ—Å–Ω—ã–π —ç–∫–≤–∞–ª–∞–π–∑–µ—Ä)
```typescript
interface EQSettings {
  lowGain: number;      // -12 –¥–æ +12 dB
  midGain: number;      // -12 –¥–æ +12 dB
  highGain: number;     // -12 –¥–æ +12 dB
  lowFreq: number;      // Hz (default 320)
  highFreq: number;     // Hz (default 3200)
}

// –ü—Ä–µ—Å–µ—Ç—ã
eqPresets = {
  flat: { lowGain: 0, midGain: 0, highGain: 0 },
  warm: { lowGain: 3, midGain: -1, highGain: -2 },
  bright: { lowGain: -2, midGain: 0, highGain: 4 },
  bass_boost: { lowGain: 6, midGain: 0, highGain: 0 },
  vocal_presence: { lowGain: -2, midGain: 3, highGain: 2 },
}
```

#### Compressor
```typescript
interface CompressorSettings {
  threshold: number;    // -100 –¥–æ 0 dB
  ratio: number;        // 1 –¥–æ 20
  attack: number;       // 0 –¥–æ 1 —Å–µ–∫
  release: number;      // 0 –¥–æ 1 —Å–µ–∫
  knee: number;         // 0 –¥–æ 40 dB
  enabled: boolean;
}

// –ü—Ä–µ—Å–µ—Ç—ã
compressorPresets = {
  gentle: { threshold: -20, ratio: 2, attack: 0.01 },
  moderate: { threshold: -24, ratio: 4, attack: 0.003 },
  heavy: { threshold: -30, ratio: 8, attack: 0.001 },
  vocals: { threshold: -18, ratio: 3, attack: 0.005 },
}
```

#### Reverb (—Å Dry/Wet)
```typescript
interface ReverbSettings {
  wetDry: number;       // 0-1 (—Å—É—Ö–æ–π/–º–æ–∫—Ä—ã–π)
  decay: number;        // 0.1-10 —Å–µ–∫—É–Ω–¥
  enabled: boolean;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–ø—É–ª—å—Å–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
function createImpulseResponse(ctx, duration, decay) {
  // –°–ª—É—á–∞–π–Ω—ã–π —à—É–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º
  for (let i = 0; i < length; i++) {
    channelData[i] = (Math.random() * 2 - 1) * 
                     Math.pow(1 - i / length, decay);
  }
}
```

### Solo/Mute Logic:

```typescript
interface StemState {
  muted: boolean;
  solo: boolean;
  volume: number;
}

// –ï—Å–ª–∏ –µ—Å—Ç—å solo - –∏–≥—Ä–∞—é—Ç —Ç–æ–ª—å–∫–æ solo —Å—Ç–µ–º—ã
const hasSolo = Object.values(stemStates).some(s => s.solo);
const isMuted = masterMuted || 
                state.muted || 
                (hasSolo && !state.solo);
const finalVolume = isMuted ? 0 : state.volume;
```

---

## –≠–∫—Å–ø–æ—Ä—Ç –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìÅ –§–∞–π–ª—ã:
- `src/hooks/useMixExport.ts` - —ç–∫—Å–ø–æ—Ä—Ç –º–∏–∫—Å–∞
- `src/hooks/studio/useTrimExport.ts` - –æ–±—Ä–µ–∑–∫–∞

### 1. Mix Export

#### –ü—Ä–æ—Ü–µ—Å—Å —ç–∫—Å–ø–æ—Ä—Ç–∞:

```
1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–µ–º–æ–≤ (solo/mute)
2. –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ –±—É—Ñ–µ—Ä–æ–≤
3. –°–æ–∑–¥–∞–Ω–∏–µ OfflineAudioContext
4. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
5. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ AudioBuffer
6. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ WAV/MP3
7. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
```

#### –ö–æ–¥:

```typescript
const exportMix = async (
  stems: StemMixData[],
  masterVolume: number,
  trackTitle: string,
  options: { format: 'wav' | 'mp3' }
) => {
  // 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  const hasSolo = stems.some(s => s.solo);
  const activeStems = stems.filter(s => 
    hasSolo ? s.solo : !s.muted
  );
  
  // 2. –ó–∞–≥—Ä—É–∑–∫–∞ –±—É—Ñ–µ—Ä–æ–≤
  const audioBuffers = await Promise.all(
    activeStems.map(async stem => {
      const response = await fetch(stem.audioUrl);
      const arrayBuffer = await response.arrayBuffer();
      const buffer = await audioContext.decodeAudioData(arrayBuffer);
      return { stem, buffer };
    })
  );
  
  // 3. OfflineAudioContext
  const maxDuration = Math.max(...audioBuffers.map(ab => ab.buffer.duration));
  const offlineContext = new OfflineAudioContext(
    2, maxDuration * sampleRate, sampleRate
  );
  
  // 4. –ì—Ä–∞—Ñ —Å —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏
  const masterGain = offlineContext.createGain();
  masterGain.gain.value = masterVolume;
  masterGain.connect(offlineContext.destination);
  
  for (const { stem, buffer } of audioBuffers) {
    // Source ‚Üí EQ ‚Üí Compressor ‚Üí Reverb ‚Üí Master
    const chain = buildEffectsChain(offlineContext, stem.effects);
    source.connect(chain.input);
    chain.output.connect(masterGain);
    source.start(0);
  }
  
  // 5. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥
  const renderedBuffer = await offlineContext.startRendering();
  
  // 6. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
  const blob = options.format === 'mp3' 
    ? audioBufferToMp3(renderedBuffer, 192)
    : audioBufferToWav(renderedBuffer);
  
  return blob;
}
```

#### WAV Encoder:

```typescript
function audioBufferToWav(buffer: AudioBuffer): Blob {
  // –°–æ–∑–¥–∞–Ω–∏–µ 44-–±–∞–π—Ç–Ω–æ–≥–æ WAV –∑–∞–≥–æ–ª–æ–≤–∫–∞
  // RIFF chunk
  writeString(view, 0, 'RIFF');
  view.setUint32(4, bufferLength - 8, true);
  writeString(view, 8, 'WAVE');
  
  // fmt chunk
  writeString(view, 12, 'fmt ');
  view.setUint16(20, 1, true); // PCM
  view.setUint16(22, numChannels, true);
  view.setUint32(24, sampleRate, true);
  
  // data chunk
  writeString(view, 36, 'data');
  view.setUint32(40, dataLength, true);
  
  // –ò–Ω—Ç–µ—Ä–ª–µ–π—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤
  for (let i = 0; i < buffer.length; i++) {
    for (let ch = 0; ch < numChannels; ch++) {
      const sample = channels[ch][i];
      const intSample = sample < 0 ? sample * 0x8000 : sample * 0x7FFF;
      view.setInt16(offset, intSample, true);
      offset += 2;
    }
  }
  
  return new Blob([arrayBuffer], { type: 'audio/wav' });
}
```

#### MP3 Encoder (lamejs):

```typescript
function audioBufferToMp3(buffer: AudioBuffer, bitRate = 192): Blob {
  const mp3encoder = new lamejs.Mp3Encoder(numChannels, sampleRate, bitRate);
  
  // Float32 ‚Üí Int16
  const leftInt16 = new Int16Array(left.length);
  for (let i = 0; i < left.length; i++) {
    leftInt16[i] = Math.round(left[i] * 32767);
  }
  
  // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞–º–∏ 1152 —Å–µ–º–ø–ª–∞
  const blockSize = 1152;
  for (let i = 0; i < leftInt16.length; i += blockSize) {
    const chunk = leftInt16.subarray(i, i + blockSize);
    const mp3buf = mp3encoder.encodeBuffer(leftChunk, rightChunk);
    if (mp3buf.length > 0) mp3Data.push(Array.from(mp3buf));
  }
  
  const mp3buf = mp3encoder.flush();
  return new Blob([combined], { type: 'audio/mp3' });
}
```

### 2. Trim Export (–û–±—Ä–µ–∑–∫–∞)

```typescript
const trimAudio = async ({ audioUrl, startTime, endTime }) => {
  // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
  const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
  
  // 2. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Å–µ–º–ø–ª–æ–≤
  const startSample = Math.floor(startTime * sampleRate);
  const endSample = Math.floor(endTime * sampleRate);
  const trimmedLength = endSample - startSample;
  
  // 3. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—É—Ñ–µ—Ä–∞
  const trimmedBuffer = audioContext.createBuffer(
    audioBuffer.numberOfChannels,
    trimmedLength,
    sampleRate
  );
  
  // 4. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  for (let ch = 0; ch < numChannels; ch++) {
    const sourceData = audioBuffer.getChannelData(ch);
    const trimmedData = trimmedBuffer.getChannelData(ch);
    for (let i = 0; i < trimmedLength; i++) {
      trimmedData[i] = sourceData[startSample + i];
    }
  }
  
  // 5. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ OfflineAudioContext
  const offlineContext = new OfflineAudioContext(
    trimmedBuffer.numberOfChannels,
    trimmedBuffer.length,
    sampleRate
  );
  
  const source = offlineContext.createBufferSource();
  source.buffer = trimmedBuffer;
  source.connect(offlineContext.destination);
  source.start();
  
  const renderedBuffer = await offlineContext.startRendering();
  const wavBlob = await audioBufferToWav(renderedBuffer);
  
  return { blob: wavBlob, url: URL.createObjectURL(wavBlob) };
}
```

---

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ

### üìÅ –§–∞–π–ª: `src/hooks/audio/useWaveform.ts`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **WaveSurfer.js** –¥–ª—è –≤–æ–ª–Ω–æ–≤–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

```typescript
const useWaveform = ({
  audioUrl,
  container,
  height = 48,
  waveColor = 'rgba(255, 255, 255, 0.3)',
  progressColor = 'rgba(255, 255, 255, 0.6)',
  barWidth = 2,
  normalize = true,
}) => {
  const wavesurfer = WaveSurfer.create({
    container,
    height,
    waveColor,
    progressColor,
    barWidth,
    barGap: 1,
    barRadius: 2,
    backend: 'WebAudio',
    interact: false,
    hideScrollbar: true,
    fillParent: true,
  });
  
  wavesurfer.on('ready', () => {
    setDuration(wavesurfer.getDuration());
  });
  
  wavesurfer.on('timeupdate', (time) => {
    setCurrentTime(time);
  });
  
  wavesurfer.load(audioUrl);
  
  return {
    wavesurfer,
    seek: (time) => wavesurfer.seekTo(time / duration),
    setVolume: (vol) => wavesurfer.setVolume(vol),
  };
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **StemWaveform** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–µ–º–æ–≤
- **AudioVisualizer** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Canvas API
- **ProgressBar** - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä

---

## –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–π —Ç—Ä–µ–∫–æ–≤

### üìÅ –§–∞–π–ª—ã:
- `src/hooks/useSectionReplacement.ts`
- `src/hooks/useSectionDetection.ts`
- `src/hooks/useReplaceSectionMutation.ts`

### –î–µ—Ç–µ–∫—Ü–∏—è —Å–µ–∫—Ü–∏–π:

```typescript
const useSectionDetection = (lyrics, alignedWords, duration) => {
  // –ü–æ–∏—Å–∫ —Ç–µ–≥–æ–≤ [Verse], [Chorus] –∏ —Ç.–¥.
  const pattern = /\[(Verse|Chorus|Bridge|Intro|Outro)\]/gi;
  
  const sections = [];
  let match;
  
  while ((match = pattern.exec(lyrics)) !== null) {
    const sectionName = match[1];
    const startIndex = match.index;
    
    // –í—Ä–µ–º—è —á–µ—Ä–µ–∑ alignedWords
    const startWord = alignedWords.find(w => w.charIndex >= startIndex);
    const startTime = startWord?.startTime || 0;
    
    // –ö–æ–Ω–µ—Ü = —Å–ª–µ–¥—É—é—â–∞—è —Å–µ–∫—Ü–∏—è –∏–ª–∏ –∫–æ–Ω–µ—Ü —Ç—Ä–µ–∫–∞
    const nextMatch = pattern.exec(lyrics);
    const endTime = nextMatch 
      ? alignedWords.find(w => w.charIndex >= nextMatch.index)?.startTime 
      : duration;
    
    sections.push({ name: sectionName, startTime, endTime, lyrics });
  }
  
  return sections;
}
```

### –ó–∞–º–µ–Ω–∞ —Å–µ–∫—Ü–∏–∏:

```typescript
const executeReplacement = async () => {
  const result = await replaceMutation.mutateAsync({
    trackId,
    prompt,
    tags,
    infillStartS: Math.round(startTime * 10) / 10,
    infillEndS: Math.round(endTime * 10) / 10,
  });
  
  if (result?.taskId) {
    setActiveTask(result.taskId);  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ
  }
}
```

### –ü—Ä–µ—Å–µ—Ç—ã:

```typescript
const SECTION_PRESETS = [
  { id: 'energetic', label: '‚ö° –≠–Ω–µ—Ä–≥–∏—á–Ω–µ–µ', 
    prompt: 'more energetic, higher tempo' },
  { id: 'soft', label: 'üéµ –ú—è–≥—á–µ', 
    prompt: 'softer, gentler, acoustic' },
  { id: 'epic', label: 'üé¨ –≠–ø–∏—á–Ω–µ–µ', 
    prompt: 'epic, orchestral, cinematic' },
  { id: 'rock', label: 'üé∏ –†–æ–∫', 
    prompt: 'rock style, distorted guitar' },
];
```

### Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```typescript
const useReplaceSectionRealtime = (trackId) => {
  useEffect(() => {
    const channel = supabase
      .channel(`replaced_sections:${trackId}`)
      .on('postgres_changes', {
        event: '*',
        schema: 'public',
        table: 'replaced_sections',
        filter: `track_id=eq.${trackId}`,
      }, (payload) => {
        queryClient.invalidateQueries(['replacedSections', trackId]);
        
        if (payload.new.status === 'completed') {
          toast.success('–ó–∞–º–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
        }
      })
      .subscribe();
    
    return () => supabase.removeChannel(channel);
  }, [trackId]);
}
```

---

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### Zustand Stores:

#### 1. playerStore (–±–∞–∑–æ–≤—ã–π)

```typescript
// src/stores/playerStore.ts
interface PlayerState {
  currentTime: number;
  isPlaying: boolean;
  setCurrentTime: (time: number) => void;
  setIsPlaying: (playing: boolean) => void;
}
```

#### 2. usePlayerState (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π)

```typescript
// src/hooks/audio/usePlayerState.ts
interface PlayerState {
  activeTrack: Track | null;
  isPlaying: boolean;
  queue: Track[];
  currentIndex: number;
  shuffle: boolean;
  repeat: 'off' | 'all' | 'one';
  playerMode: 'minimized' | 'compact' | 'expanded' | 'fullscreen';
  
  playTrack: (track?: Track) => void;
  pauseTrack: () => void;
  nextTrack: () => void;
  previousTrack: () => void;
  addToQueue: (track: Track) => void;
  removeFromQueue: (index: number) => void;
  toggleShuffle: () => void;
  toggleRepeat: () => void;
}
```

#### 3. sectionEditorStore

```typescript
// src/stores/useSectionEditorStore.ts
interface SectionEditorState {
  editMode: 'select' | 'custom' | null;
  selectedSectionIndex: number | null;
  customRange: { start: number; end: number } | null;
  activeTask: string | null;
  
  selectSection: (index: number) => void;
  setCustomRange: (start: number, end: number) => void;
  clearSelection: () => void;
  reset: () => void;
}
```

#### 4. lyricsWizardStore (—Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é)

```typescript
// src/stores/lyricsWizardStore.ts
export const useLyricsWizardStore = create<LyricsWizardState>()(
  persist(
    (set, get) => ({
      currentStep: 0,
      theme: '',
      generatedLyrics: '',
      setTheme: (theme) => set({ theme }),
      generateLyrics: async () => { /* AI logic */ },
    }),
    {
      name: 'lyrics-wizard-storage',
      storage: createJSONStorage(() => localStorage),
    }
  )
);
```

---

## –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞:

```
User clicks track
      ‚Üì
TrackCard.onClick()
      ‚Üì
usePlayerStore.playTrack(track)
      ‚Üì
playerLogic.playTrack()
  - Check if same track
  - Update queue index if needed
  - Set activeTrack, isPlaying=true
      ‚Üì
useGlobalAudioPlayer (effect)
      ‚Üì
Audio element update
  - Get source (streaming ‚Üí local ‚Üí original)
  - Load if changed
  - Call audio.play()
      ‚Üì
HTML5 Audio playback
      ‚Üì
Events:
  - timeupdate ‚Üí update state
  - ended ‚Üí nextTrack()
  - error ‚Üí fallback source
      ‚Üì
Components re-render
```

### 2. –≠–∫—Å–ø–æ—Ä—Ç –º–∏–∫—Å–∞:

```
User clicks "Export"
      ‚Üì
useMixExport.downloadMix()
      ‚Üì
exportMix() async:
  1. Filter active stems (10%)
  2. Load audio buffers (30%)
  3. Create OfflineAudioContext (40%)
  4. Build effects graph (50-80%)
  5. Render (85%)
  6. Convert WAV/MP3 (95%)
  7. Download (100%)
      ‚Üì
File downloaded
```

### 3. –ó–∞–º–µ–Ω–∞ —Å–µ–∫—Ü–∏–∏:

```
User selects & clicks "Replace"
      ‚Üì
useSectionReplacement.executeReplacement()
      ‚Üì
useReplaceSectionMutation.mutateAsync()
      ‚Üì
Supabase Edge Function: suno-replace-section
      ‚Üì
Edge Function:
  1. Call Suno API
  2. Create task record
  3. Return taskId
      ‚Üì
Database insert: replaced_sections
      ‚Üì
useSectionEditorStore.setActiveTask(taskId)
      ‚Üì
Realtime subscription listening
      ‚Üì
When status ‚Üí 'completed':
  - Show toast
  - Invalidate cache
  - Show preview
```

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. Singleton Pattern

```typescript
// –ï–¥–∏–Ω—ã–π Audio Element
let globalAudioElement: HTMLAudioElement | null = null;

// Shared AudioContext
let sharedAudioContext: AudioContext | null = null;
```

### 2. Cleanup

```typescript
useEffect(() => {
  return () => {
    audio.pause();
    audio.src = '';  // Release memory
    audio = null;
  };
}, []);
```

### 3. Memoization

```typescript
export const StemChannel = React.memo(({ stem, volume, onVolumeChange }) => {
  // Heavy component in list
});

const updateVolume = useCallback((stemId, vol) => {
  setStemVolume(stemId, vol);
}, [setStemVolume]);
```

### 4. Debouncing

```typescript
const debouncedSeek = useDebouncedCallback((time) => {
  audioElement.currentTime = time;
}, 50);
```

### 5. Batch Updates

```typescript
// Single re-render –≤–º–µ—Å—Ç–æ 4-—Ö
usePlayerStore.setState({
  activeTrack: newTrack,
  isPlaying: true,
  currentIndex: newIndex,
  playerMode: 'compact',
});
```

### 6. Virtualization

```typescript
import { Virtuoso } from 'react-virtuoso';

<Virtuoso
  data={queue}
  itemContent={(index, track) => <QueueItem track={track} />}
  style={{ height: '400px' }}
/>
```

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ layers (UI, Hooks, State, Web Audio, Storage)
2. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å**: Hooks –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
3. **Singleton pattern**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
4. **Web Audio API**: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –Ω–∏–∑–∫–∞—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
5. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
6. **Realtime**: Supabase subscriptions –¥–ª—è –∂–∏–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫:

- **State Management**: Zustand (–ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π)
- **Audio Processing**: Web Audio API (–Ω–∞—Ç–∏–≤–Ω—ã–π, –º–æ—â–Ω—ã–π)
- **Visualization**: WaveSurfer.js + Canvas API
- **Export**: OfflineAudioContext + lamejs (MP3)
- **Storage**: localStorage + Supabase Storage
- **Realtime**: Supabase Realtime subscriptions
- **Query**: TanStack Query (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, optimistic updates)

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:

- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ —Ü–µ–ø—å
- –ú–æ–¥—É–ª—å–Ω—ã–µ hooks –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
- –ì–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π (gapless playback, crossfade)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
src/
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGlobalAudioPlayer.ts    # Singleton player
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usePlaybackQueue.ts        # Queue management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usePlayerState.ts          # State store
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useWaveform.ts             # Visualization
‚îÇ   ‚îú‚îÄ‚îÄ studio/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useStemStudioEngine.ts     # Multi-stem manager
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useStemAudioEngine.ts      # Single stem
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useStudioPlayer.ts         # Studio playback
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTrimExport.ts           # Trim audio
‚îÇ   ‚îú‚îÄ‚îÄ useMixExport.ts                # Mix export
‚îÇ   ‚îú‚îÄ‚îÄ useSectionReplacement.ts       # Section editing
‚îÇ   ‚îî‚îÄ‚îÄ useSectionDetection.ts         # Section detection
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îú‚îÄ‚îÄ playerStore.ts                 # Basic player state
‚îÇ   ‚îú‚îÄ‚îÄ lyricsWizardStore.ts           # AI lyrics
‚îÇ   ‚îú‚îÄ‚îÄ planTrackStore.ts              # Track planning
‚îÇ   ‚îî‚îÄ‚îÄ useSectionEditorStore.ts       # Section editor
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ player/                        # Player UI components
    ‚îÇ   ‚îú‚îÄ‚îÄ MiniPlayer.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ ExpandedPlayer.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ MobileFullscreenPlayer.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ PlaybackControls.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ ProgressBar.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ VolumeControl.tsx
    ‚îÇ   ‚îú‚îÄ‚îÄ QueueSheet.tsx
    ‚îÇ   ‚îî‚îÄ‚îÄ AudioVisualizer.tsx
    ‚îî‚îÄ‚îÄ stem-studio/                   # Studio components
        ‚îú‚îÄ‚îÄ StemStudioContent.tsx
        ‚îú‚îÄ‚îÄ StemChannel.tsx
        ‚îú‚îÄ‚îÄ StemWaveform.tsx
        ‚îú‚îÄ‚îÄ MixExportDialog.tsx
        ‚îú‚îÄ‚îÄ TrimDialog.tsx
        ‚îî‚îÄ‚îÄ effects/
            ‚îú‚îÄ‚îÄ EqualizerControl.tsx
            ‚îú‚îÄ‚îÄ CompressorControl.tsx
            ‚îî‚îÄ‚îÄ ReverbControl.tsx
```

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 9 –¥–µ–∫–∞–±—Ä—è 2025
