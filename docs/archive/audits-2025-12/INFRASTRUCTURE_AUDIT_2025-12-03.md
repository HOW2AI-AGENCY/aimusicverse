# –ê—É–¥–∏—Ç –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - 2025-12-03

## üìã –†–µ–∑—é–º–µ

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç —Å–ø—Ä–∏–Ω—Ç–æ–≤ –∏ –∑–∞–¥–∞—á —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞-–∞—Å—Å–µ—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è**: 2025-12-03  
**–ê—É–¥–∏—Ç–æ—Ä**: GitHub Copilot Agent  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ù–∞—Ö–æ–¥–∫–∏

### –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ (Current State)

#### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: 29 –º–∏–≥—Ä–∞—Ü–∏–π, –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
2. **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: 1 bucket (project-assets) –¥–ª—è –º–µ–¥–∏–∞-–∞—Å—Å–µ—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–æ–≤
3. **–°–ø—Ä–∏–Ω—Ç—ã**: 8-15 –¥–µ—Ç–∞–ª—å–Ω–æ —Å–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã (105 –∑–∞–¥–∞—á –≤ E007)
4. **API**: 25+ Supabase Edge Functions —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
5. **–¢–∏–ø—ã**: TypeScript —Ç–∏–ø—ã –¥–ª—è —Ç—Ä–µ–∫–æ–≤, –≤–µ—Ä—Å–∏–π, —Å—Ç–µ–º–æ–≤

#### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ü—Ä–æ–±–µ–ª—ã:

1. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è:**
   - –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ (audio files)
   - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∞—É–¥–∏–æ
   - –û–±–ª–æ–∂–µ–∫ —Ç—Ä–µ–∫–æ–≤ (cover images)
   - –°—Ç–µ–º–æ–≤ (vocals, drums, bass, other)
   - –ú–µ–¥–∏–∞-–∞—Å—Å–µ—Ç–æ–≤ (banners, avatars, project assets)
   - –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏

2. **–ù–µ—Ç —Ç–∞–±–ª–∏—Ü –¥–ª—è:**
   - –£—á–µ—Ç–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (storage_usage, storage_quotas)
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–∏–∞ (media_cache)
   - CDN –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (cdn_assets)
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ñ–∞–π–ª–æ–≤ (file_lifecycle)

3. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
   - CDN –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –¢—Ä–∞–Ω—Å–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∞—É–¥–∏–æ

---

## üìä –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –°–ø—Ä–∏–Ω—Ç–æ–≤

### Sprint 008: Library & Player MVP (Dec 15-29)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω  
**–ó–∞–¥–∞—á–∏**: 22 –∑–∞–¥–∞—á–∏  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- Storage –¥–ª—è –æ–±–ª–æ–∂–µ–∫ —Ç—Ä–µ–∫–æ–≤ ‚ùå
- CDN –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ ‚ùå
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ ‚ùå

### Sprint 009: Track Details & Actions (Dec 29 - Jan 12)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω  
**–ó–∞–¥–∞—á–∏**: 19 –∑–∞–¥–∞—á  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- Storage –¥–ª—è –≤–µ—Ä—Å–∏–π —Ç—Ä–µ–∫–æ–≤ ‚ùå
- Storage –¥–ª—è —Å—Ç–µ–º–æ–≤ ‚ùå
- –¢–∞–±–ª–∏—Ü–∞ track_versions (–µ—Å—Ç—å –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö ‚úÖ)
- –¢–∞–±–ª–∏—Ü–∞ track_stems (–µ—Å—Ç—å –≤ –º–∏–≥—Ä–∞—Ü–∏—è—Ö ‚úÖ)

### Sprint 010: Homepage Discovery & AI Assistant (Jan 12-26)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω  
**–ó–∞–¥–∞—á–∏**: 29 –∑–∞–¥–∞—á (25 –æ—Å–Ω–æ–≤–Ω—ã—Ö + 4 –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö)
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (is_public, is_featured)
- ‚ùå CDN –¥–ª—è homepage thumbnails
- ‚ùå –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤

### Sprint 011: Social Features (Jan 26 - Feb 09)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ Outlined  
**–ó–∞–¥–∞—á–∏**: 28-32 –∑–∞–¥–∞—á–∏  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚ùå Storage –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚ùå Storage –¥–ª—è –±–∞–Ω–Ω–µ—Ä–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π
- ‚ùå –¢–∞–±–ª–∏—Ü—ã –¥–ª—è user_profiles
- ‚ùå –¢–∞–±–ª–∏—Ü—ã –¥–ª—è follows, comments

### Sprint 012: Monetization (Feb 09-23)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ Outlined  
**–ó–∞–¥–∞—á–∏**: 24-28 –∑–∞–¥–∞—á  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚ùå –¢–∞–±–ª–∏—Ü—ã –¥–ª—è credits, subscriptions
- ‚ùå Storage quotas –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
- ‚ùå Rate limiting infrastructure

### Sprint 013: Advanced Audio Features (Feb 23 - Mar 09)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ Outlined  
**–ó–∞–¥–∞—á–∏**: 26-30 –∑–∞–¥–∞—á  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚ùå Storage –¥–ª—è —Å—Ç–µ–º–æ–≤ (critical!)
- ‚ùå Storage –¥–ª—è –º–∏–∫—Å–æ–≤
- ‚ùå –¢–∞–±–ª–∏—Ü—ã stem_files, user_mixes
- ‚ùå –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö (10-50MB per stem)

### Sprint 014: Platform Integration (Mar 09-23)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ Outlined  
**–ó–∞–¥–∞—á–∏**: 22-26 –∑–∞–¥–∞—á  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚ùå API keys storage
- ‚ùå Webhooks storage
- ‚ùå Distributions tracking

### Sprint 015: Quality & Testing (Mar 23 - Apr 06)
**–°—Ç–∞—Ç—É—Å**: ‚è≥ Outlined  
**–ó–∞–¥–∞—á–∏**: 30-35 –∑–∞–¥–∞—á  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**:
- ‚ùå Monitoring infrastructure
- ‚ùå Logging aggregation
- ‚ùå Performance monitoring
- ‚ùå Error tracking (Sentry)

---

## üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –°–∏—Å—Ç–µ–º–∞ –•—Ä–∞–Ω–µ–Ω–∏—è (Storage System)

#### 1.1 –ù–æ–≤—ã–µ Storage Buckets

```sql
-- –°–æ–∑–¥–∞—Ç—å buckets –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –º–µ–¥–∏–∞
INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types) VALUES
  -- –¢—Ä–µ–∫–∏ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã)
  ('tracks', 'tracks', false, 52428800, ARRAY['audio/mpeg', 'audio/wav', 'audio/ogg']),
  
  -- –û–±–ª–æ–∂–∫–∏ —Ç—Ä–µ–∫–æ–≤ (–ø—É–±–ª–∏—á–Ω—ã–µ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
  ('covers', 'covers', true, 5242880, ARRAY['image/jpeg', 'image/png', 'image/webp']),
  
  -- –°—Ç–µ–º—ã (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã)
  ('stems', 'stems', false, 104857600, ARRAY['audio/wav', 'audio/flac']),
  
  -- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∞—É–¥–∏–æ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ)
  ('uploads', 'uploads', false, 52428800, ARRAY['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/m4a']),
  
  -- –ê–≤–∞—Ç–∞—Ä—ã –∏ –±–∞–Ω–Ω–µ—Ä—ã (–ø—É–±–ª–∏—á–Ω—ã–µ)
  ('avatars', 'avatars', true, 2097152, ARRAY['image/jpeg', 'image/png', 'image/webp']),
  
  -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ, –∫–æ—Ä–æ—Ç–∫–∏–π TTL)
  ('temp', 'temp', false, 104857600, NULL)
ON CONFLICT (id) DO NOTHING;
```

#### 1.2 Storage Policies (RLS)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ bucket –Ω—É–∂–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞:

**tracks bucket**:
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ç—Ä–µ–∫–∏
CREATE POLICY "Users can view own tracks"
ON storage.objects FOR SELECT
USING (bucket_id = 'tracks' AND auth.uid()::text = (storage.foldername(name))[1]);

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç –≤ —Å–≤–æ—é –ø–∞–ø–∫—É
CREATE POLICY "Users can upload own tracks"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id = 'tracks' AND auth.uid()::text = (storage.foldername(name))[1]);

-- –ü—É–±–ª–∏—á–Ω—ã–µ —Ç—Ä–µ–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º
CREATE POLICY "Public tracks viewable by all"
ON storage.objects FOR SELECT
USING (
  bucket_id = 'tracks' AND
  EXISTS (
    SELECT 1 FROM tracks 
    WHERE tracks.audio_url = storage.objects.name 
    AND tracks.is_public = true
  )
);
```

**covers bucket** (–ø—É–±–ª–∏—á–Ω—ã–π):
```sql
-- –í—Å–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å –æ–±–ª–æ–∂–∫–∏
CREATE POLICY "Anyone can view covers"
ON storage.objects FOR SELECT
USING (bucket_id = 'covers');

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç —Å–≤–æ–∏ –æ–±–ª–æ–∂–∫–∏
CREATE POLICY "Users can upload own covers"
ON storage.objects FOR INSERT
WITH CHECK (bucket_id = 'covers' AND auth.uid()::text = (storage.foldername(name))[1]);
```

**stems bucket**:
```sql
-- –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—ã —Ç—Ä–µ–∫–æ–≤ –∏ Premium –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
CREATE POLICY "Premium users can view own stems"
ON storage.objects FOR SELECT
USING (
  bucket_id = 'stems' AND
  auth.uid()::text = (storage.foldername(name))[1] AND
  EXISTS (
    SELECT 1 FROM user_subscriptions 
    WHERE user_id = auth.uid() 
    AND tier IN ('premium', 'enterprise')
    AND status = 'active'
  )
);
```

---

### 2. –ù–æ–≤—ã–µ –¢–∞–±–ª–∏—Ü—ã –ë–î

#### 2.1 Storage Management

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —É—á–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
CREATE TABLE storage_usage (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  total_bytes BIGINT DEFAULT 0,
  tracks_bytes BIGINT DEFAULT 0,
  covers_bytes BIGINT DEFAULT 0,
  stems_bytes BIGINT DEFAULT 0,
  uploads_bytes BIGINT DEFAULT 0,
  avatars_bytes BIGINT DEFAULT 0,
  quota_bytes BIGINT DEFAULT 1073741824, -- 1GB –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Ñ–∞–π–ª–æ–≤ (–∞—É–¥–∏—Ç –∏ –æ—á–∏—Å—Ç–∫–∞)
CREATE TABLE file_registry (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  bucket_id TEXT NOT NULL,
  file_path TEXT NOT NULL,
  file_size_bytes BIGINT NOT NULL,
  mime_type TEXT,
  entity_type TEXT, -- 'track', 'cover', 'stem', 'avatar', etc.
  entity_id UUID, -- —Å–≤—è–∑—å —Å —Ç—Ä–µ–∫–æ–º, –ø—Ä–æ–µ–∫—Ç–æ–º –∏ —Ç.–¥.
  is_temporary BOOLEAN DEFAULT FALSE,
  expires_at TIMESTAMPTZ, -- –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(bucket_id, file_path)
);

CREATE INDEX idx_file_registry_user ON file_registry(user_id);
CREATE INDEX idx_file_registry_entity ON file_registry(entity_type, entity_id);
CREATE INDEX idx_file_registry_expires ON file_registry(expires_at) WHERE is_temporary = TRUE;

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è storage_usage
CREATE OR REPLACE FUNCTION update_storage_usage()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE storage_usage
    SET 
      total_bytes = total_bytes + NEW.file_size_bytes,
      tracks_bytes = CASE WHEN NEW.bucket_id = 'tracks' THEN tracks_bytes + NEW.file_size_bytes ELSE tracks_bytes END,
      covers_bytes = CASE WHEN NEW.bucket_id = 'covers' THEN covers_bytes + NEW.file_size_bytes ELSE covers_bytes END,
      stems_bytes = CASE WHEN NEW.bucket_id = 'stems' THEN stems_bytes + NEW.file_size_bytes ELSE stems_bytes END,
      uploads_bytes = CASE WHEN NEW.bucket_id = 'uploads' THEN uploads_bytes + NEW.file_size_bytes ELSE uploads_bytes END,
      avatars_bytes = CASE WHEN NEW.bucket_id = 'avatars' THEN avatars_bytes + NEW.file_size_bytes ELSE avatars_bytes END,
      updated_at = NOW()
    WHERE user_id = NEW.user_id;
  ELSIF TG_OP = 'DELETE' THEN
    UPDATE storage_usage
    SET 
      total_bytes = total_bytes - OLD.file_size_bytes,
      tracks_bytes = CASE WHEN OLD.bucket_id = 'tracks' THEN tracks_bytes - OLD.file_size_bytes ELSE tracks_bytes END,
      covers_bytes = CASE WHEN OLD.bucket_id = 'covers' THEN covers_bytes - OLD.file_size_bytes ELSE covers_bytes END,
      stems_bytes = CASE WHEN OLD.bucket_id = 'stems' THEN stems_bytes - OLD.file_size_bytes ELSE stems_bytes END,
      uploads_bytes = CASE WHEN OLD.bucket_id = 'uploads' THEN uploads_bytes - OLD.file_size_bytes ELSE uploads_bytes END,
      avatars_bytes = CASE WHEN OLD.bucket_id = 'avatars' THEN avatars_bytes - OLD.file_size_bytes ELSE avatars_bytes END,
      updated_at = NOW()
    WHERE user_id = OLD.user_id;
  END IF;
  RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER file_registry_storage_trigger
AFTER INSERT OR DELETE ON file_registry
FOR EACH ROW EXECUTE FUNCTION update_storage_usage();
```

#### 2.2 CDN & Media Cache

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è CDN –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
CREATE TABLE cdn_assets (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  original_url TEXT NOT NULL UNIQUE,
  cdn_url TEXT NOT NULL,
  asset_type TEXT NOT NULL, -- 'image', 'audio', 'video'
  width INTEGER,
  height INTEGER,
  format TEXT, -- 'webp', 'mp3', etc.
  file_size_bytes BIGINT,
  cache_hit_count INTEGER DEFAULT 0,
  last_accessed_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_cdn_assets_url ON cdn_assets(original_url);
CREATE INDEX idx_cdn_assets_type ON cdn_assets(asset_type);
CREATE INDEX idx_cdn_assets_accessed ON cdn_assets(last_accessed_at DESC);
```

#### 2.3 Media Processing Queue

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞
CREATE TABLE media_processing_queue (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  task_type TEXT NOT NULL, -- 'transcode_audio', 'optimize_image', 'generate_thumbnail', 'separate_stems'
  input_url TEXT NOT NULL,
  output_bucket TEXT NOT NULL,
  output_path TEXT,
  status TEXT DEFAULT 'pending', -- 'pending', 'processing', 'completed', 'failed'
  progress INTEGER DEFAULT 0, -- 0-100
  error_message TEXT,
  metadata JSONB,
  priority INTEGER DEFAULT 0, -- 0 = normal, 10 = high, -10 = low
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_media_queue_status ON media_processing_queue(status, priority DESC, created_at ASC);
CREATE INDEX idx_media_queue_user ON media_processing_queue(user_id);
```

#### 2.4 Asset Optimization Settings

```sql
-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∞—Å—Å–µ—Ç–æ–≤
CREATE TABLE asset_optimization_settings (
  asset_type TEXT PRIMARY KEY, -- 'cover', 'avatar', 'track', 'stem'
  max_width INTEGER,
  max_height INTEGER,
  quality INTEGER, -- 1-100 –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  format TEXT, -- –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç ('webp', 'mp3', etc.)
  compression_level INTEGER, -- 0-9 –¥–ª—è –∞—É–¥–∏–æ
  generate_thumbnails BOOLEAN DEFAULT FALSE,
  thumbnail_sizes INTEGER[], -- –º–∞—Å—Å–∏–≤ —Ä–∞–∑–º–µ—Ä–æ–≤ [128, 256, 512]
  max_duration_seconds INTEGER, -- –¥–ª—è –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ
  bitrate_kbps INTEGER, -- –¥–ª—è –∞—É–¥–∏–æ
  sample_rate_hz INTEGER, -- –¥–ª—è –∞—É–¥–∏–æ
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ó–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
INSERT INTO asset_optimization_settings (asset_type, max_width, max_height, quality, format, generate_thumbnails, thumbnail_sizes, bitrate_kbps, sample_rate_hz) VALUES
  ('cover', 3000, 3000, 90, 'webp', TRUE, ARRAY[256, 512, 1024], NULL, NULL),
  ('avatar', 512, 512, 85, 'webp', TRUE, ARRAY[64, 128, 256], NULL, NULL),
  ('track', NULL, NULL, NULL, 'mp3', TRUE, NULL, 320, 48000),
  ('stem', NULL, NULL, NULL, 'wav', FALSE, NULL, NULL, 48000);
```

---

### 3. Storage Lifecycle Management

#### 3.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –û—á–∏—Å—Ç–∫–∞

```sql
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏—Å—Ç–µ–∫—à–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
CREATE OR REPLACE FUNCTION cleanup_expired_files()
RETURNS INTEGER AS $$
DECLARE
  deleted_count INTEGER;
BEGIN
  -- –£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ —Ñ–∞–π–ª—ã –∏–∑ file_registry
  WITH deleted AS (
    DELETE FROM file_registry
    WHERE is_temporary = TRUE 
    AND expires_at < NOW()
    RETURNING *
  )
  SELECT COUNT(*) INTO deleted_count FROM deleted;
  
  RETURN deleted_count;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –°–æ–∑–¥–∞—Ç—å Edge Function –¥–ª—è –≤—ã–∑–æ–≤–∞ —á–µ—Ä–µ–∑ cron
-- supabase/functions/cleanup-expired-files/index.ts
```

#### 3.2 Storage Quotas –ø–æ –¢–∞—Ä–∏—Ñ–∞–º

```sql
-- –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É user_subscriptions —Å –∫–≤–æ—Ç–∞–º–∏
ALTER TABLE user_subscriptions 
ADD COLUMN storage_quota_gb INTEGER DEFAULT 1;

-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–≤–æ—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
UPDATE user_subscriptions SET storage_quota_gb = 1 WHERE tier = 'free';
UPDATE user_subscriptions SET storage_quota_gb = 50 WHERE tier = 'pro';
UPDATE user_subscriptions SET storage_quota_gb = 500 WHERE tier = 'premium';
UPDATE user_subscriptions SET storage_quota_gb = NULL WHERE tier = 'enterprise'; -- unlimited

-- –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–≤–æ—Ç—ã
CREATE OR REPLACE FUNCTION check_storage_quota(user_uuid UUID, additional_bytes BIGINT)
RETURNS BOOLEAN AS $$
DECLARE
  current_usage BIGINT;
  user_quota BIGINT;
BEGIN
  -- –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  SELECT total_bytes INTO current_usage
  FROM storage_usage
  WHERE user_id = user_uuid;
  
  -- –ü–æ–ª—É—á–∏—Ç—å –∫–≤–æ—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  SELECT storage_quota_gb * 1073741824 INTO user_quota
  FROM user_subscriptions
  WHERE user_id = user_uuid AND status = 'active'
  ORDER BY created_at DESC
  LIMIT 1;
  
  -- –ï—Å–ª–∏ –∫–≤–æ—Ç–∞ NULL (unlimited), –≤–µ—Ä–Ω—É—Ç—å true
  IF user_quota IS NULL THEN
    RETURN TRUE;
  END IF;
  
  -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç –ª–∏ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –∫–≤–æ—Ç—É
  RETURN (COALESCE(current_usage, 0) + additional_bytes) <= user_quota;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

---

### 4. CDN Integration

#### 4.1 CDN Configuration

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å CDN (Cloudflare, CloudFront, –∏–ª–∏ Bunny CDN):

**–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (covers, avatars)**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å image resizing on-the-fly
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 1 –≥–æ–¥ (immutable)
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WebP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å responsive sizes

**–î–ª—è –∞—É–¥–∏–æ (tracks, stems)**:
- HTTP Range requests –¥–ª—è streaming
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 30 –¥–Ω–µ–π
- Gzip compression
- HLS –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ (optional)

#### 4.2 CDN Helper Functions

```typescript
// src/lib/cdn.ts
export const getCDNUrl = (originalUrl: string, options?: {
  width?: number;
  height?: number;
  format?: 'webp' | 'jpeg' | 'png';
  quality?: number;
}): string => {
  // –ï—Å–ª–∏ CDN –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –≤–µ—Ä–Ω—É—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
  const cdnBase = import.meta.env.VITE_CDN_BASE_URL;
  if (!cdnBase) return originalUrl;
  
  // –ü–æ—Å—Ç—Ä–æ–∏—Ç—å URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
  const params = new URLSearchParams();
  if (options?.width) params.set('w', options.width.toString());
  if (options?.height) params.set('h', options.height.toString());
  if (options?.format) params.set('f', options.format);
  if (options?.quality) params.set('q', options.quality.toString());
  
  return `${cdnBase}/${originalUrl}?${params.toString()}`;
};

export const getTrackStreamingUrl = (trackUrl: string): string => {
  const cdnBase = import.meta.env.VITE_CDN_BASE_URL;
  if (!cdnBase) return trackUrl;
  return `${cdnBase}/${trackUrl}`;
};
```

---

### 5. –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–°–æ–∑–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

#### Migration 1: Storage Buckets Setup
**File**: `20251203020000_create_storage_buckets.sql`
```sql
-- –°–º. —Ä–∞–∑–¥–µ–ª 1.1 –≤—ã—à–µ
```

#### Migration 2: Storage Management Tables
**File**: `20251203020001_create_storage_management.sql`
```sql
-- –°–º. —Ä–∞–∑–¥–µ–ª 2.1 –≤—ã—à–µ
```

#### Migration 3: CDN & Media Cache
**File**: `20251203020002_create_cdn_media_cache.sql`
```sql
-- –°–º. —Ä–∞–∑–¥–µ–ª 2.2 –∏ 2.3 –≤—ã—à–µ
```

#### Migration 4: Storage Lifecycle
**File**: `20251203020003_create_storage_lifecycle.sql`
```sql
-- –°–º. —Ä–∞–∑–¥–µ–ª 3 –≤—ã—à–µ
```

---

## üìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ó–∞–¥–∞—á–∏ –°–ø—Ä–∏–Ω—Ç–æ–≤

### Sprint 010: Infrastructure Setup (HIGH PRIORITY)

–î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏ –≤ –Ω–∞—á–∞–ª–æ —Å–ø—Ä–∏–Ω—Ç–∞:

```markdown
### Phase 0: Infrastructure Prerequisites (CRITICAL - BLOCKING)

- [ ] INF-010-001 [P] Create storage buckets migration (tracks, covers, stems, uploads, avatars, temp)
- [ ] INF-010-002 [P] Create storage management tables (storage_usage, file_registry)
- [ ] INF-010-003 [P] Create CDN integration tables (cdn_assets, media_processing_queue)
- [ ] INF-010-004 [P] Create asset optimization settings table
- [ ] INF-010-005 [P] Setup storage policies (RLS) for all buckets
- [ ] INF-010-006 [P] Implement storage quota checker function
- [ ] INF-010-007 [P] Create cleanup_expired_files scheduled function
- [ ] INF-010-008 [P] Add storage usage tracking to user profiles
- [ ] INF-010-009 Setup CDN provider account (Cloudflare/Bunny)
- [ ] INF-010-010 [P] Create getCDNUrl helper in src/lib/cdn.ts
- [ ] INF-010-011 [P] Update track upload flow to use new storage system
- [ ] INF-010-012 [P] Update cover upload to use covers bucket with optimization

**Estimated**: 8 SP  
**Duration**: 2-3 days  
**Blocking**: All subsequent features that use media storage
```

### Sprint 011: Social Features Updates

–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏:

```markdown
- [ ] INF-011-001 [P] Implement avatar upload with optimization (64x64, 128x128, 256x256)
- [ ] INF-011-002 [P] Implement banner upload with optimization (1500x500)
- [ ] INF-011-003 [P] Add storage quota warnings for users approaching limit
- [ ] INF-011-004 [P] Create storage usage dashboard component
```

### Sprint 012: Monetization Updates

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å storage quotas:

```markdown
- [ ] INF-012-001 [P] Update subscription tiers with storage quotas
- [ ] INF-012-002 [P] Implement storage quota enforcement on upload
- [ ] INF-012-003 [P] Add storage upgrade prompts in UI
- [ ] INF-012-004 [P] Create storage analytics dashboard for admins
```

### Sprint 013: Advanced Audio Updates

–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–µ–º–∞–º–∏:

```markdown
- [ ] INF-013-001 [P] Setup large file upload support (chunked upload)
- [ ] INF-013-002 [P] Implement stem separation queue with priority
- [ ] INF-013-003 [P] Add progress tracking for long operations
- [ ] INF-013-004 [P] Implement stem file cleanup after 30 days (configurable)
```

### Sprint 016: Infrastructure Hardening (NEW)

–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å–ø—Ä–∏–Ω—Ç –¥–ª—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```markdown
# Sprint 016: Infrastructure Hardening & Optimization

**Period**: 2026-04-06 - 2026-04-20 (2 –Ω–µ–¥–µ–ª–∏)  
**Focus**: Production-ready infrastructure, monitoring, scaling  
**Estimated Tasks**: 24-28 –∑–∞–¥–∞—á

## Areas

### 1. Storage Optimization
- [ ] Implement automatic image optimization pipeline
- [ ] Setup audio transcoding pipeline (multiple bitrates)
- [ ] Add progressive audio streaming (HLS)
- [ ] Implement storage tiering (hot/warm/cold)
- [ ] Add deduplication for identical files

### 2. CDN & Caching
- [ ] Configure edge caching rules
- [ ] Implement cache invalidation API
- [ ] Add cache warming for popular content
- [ ] Setup geographic distribution
- [ ] Monitor cache hit rates

### 3. Performance Monitoring
- [ ] Setup storage metrics dashboard
- [ ] Monitor upload/download speeds
- [ ] Track CDN performance
- [ ] Alert on storage quota violations
- [ ] Track media processing queue depth

### 4. Backup & Recovery
- [ ] Implement automated backup for all buckets
- [ ] Setup point-in-time recovery
- [ ] Create disaster recovery plan
- [ ] Test restoration procedures
- [ ] Document recovery SLAs

### 5. Security Hardening
- [ ] Implement virus scanning for uploads
- [ ] Add watermarking for premium content
- [ ] Setup DRM for commercial tracks
- [ ] Audit storage access logs
- [ ] Implement geo-restrictions if needed
```

---

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ - Sprint 010)

1. **–°–æ–∑–¥–∞—Ç—å storage buckets** –¥–ª—è tracks, covers, stems, uploads
2. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã** storage_usage, file_registry
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å RLS policies** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
4. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å storage quota** checking

**–†–∏—Å–∫ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

### –í—ã—Å–æ–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Sprint 011-012)

1. **CDN integration** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
2. **Media optimization** pipeline (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ‚Üí WebP, –∞—É–¥–∏–æ ‚Üí –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∏—Ç—Ä–µ–π—Ç–∞)
3. **Storage quotas** –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º –ø–æ–¥–ø–∏—Å–∫–∏
4. **Cleanup automation** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–†–∏—Å–∫ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è**: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –≤—ã—Å–æ–∫–∏–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –ø–ª–æ—Ö–æ–π UX

### –°—Ä–µ–¥–Ω–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Sprint 013-014)

1. **Chunked upload** –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
2. **Processing queue** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
3. **Storage analytics** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–æ–≤
4. **Backup automation**

### –ù–∏–∑–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Sprint 015-016)

1. **Advanced optimization** (deduplication, tiering)
2. **HLS streaming** –¥–ª—è –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
3. **Virus scanning**
4. **DRM** –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

---

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–µ–∫**: <500ms (—Å CDN)
- **–ù–∞—á–∞–ª–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è**: <1s (—Å CDN + streaming)
- **Upload tracks**: Chunked upload –¥–ª—è —Ñ–∞–π–ª–æ–≤ >10MB
- **Image optimization**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∞—Ç–∏–µ –¥–æ 70-90% –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞

### –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **Storage**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ unlimited storage –¥–ª—è Enterprise
- **CDN**: –ì–ª–æ–±–∞–ª—å–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **Processing**: –û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏
- **Cleanup**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **RLS**: –í—Å–µ buckets –∑–∞—â–∏—â–µ–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- **Quotas**: –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
- **Audit**: –ü–æ–ª–Ω—ã–π –ª–æ–≥ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- **Encryption**: –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã at rest

### –≠–∫–æ–Ω–æ–º–∏—è
- **Storage**: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Üí 50-70% —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
- **Bandwidth**: CDN ‚Üí 60-80% —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ origin
- **Costs**: Lifecycle management ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤

---

## üöÄ –ü–ª–∞–Ω –í–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ù–µ–¥–µ–ª—è 1 (Sprint 010 Start)
1. –°–æ–∑–¥–∞—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è storage infrastructure
2. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å storage buckets —Å RLS
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å upload/download flow
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API

### –ù–µ–¥–µ–ª—è 2
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å CDN provider
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å image optimization
3. –î–æ–±–∞–≤–∏—Ç—å storage quota checking
4. –°–æ–∑–¥–∞—Ç—å dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ù–µ–¥–µ–ª—è 3-4 (Sprint 011)
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å avatar/banner upload
2. –î–æ–±–∞–≤–∏—Ç—å media processing queue
3. –í–Ω–µ–¥—Ä–∏—Ç—å cleanup automation
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ load testing

### –ú–µ—Å—è—Ü 2 (Sprint 012-013)
1. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å quotas —Å billing
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å chunked upload
3. –î–æ–±–∞–≤–∏—Ç—å stem storage support
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

1. **–£—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–ª–∞–Ω** —Å –∫–æ–º–∞–Ω–¥–æ–π –∏ stakeholders
2. **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** –¥–ª—è Sprint 010 Phase 0
3. **–û–±–Ω–æ–≤–∏—Ç—å —Å–ø—Ä–∏–Ω—Ç—ã** —Å –Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
4. **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –ø—Ä–æ–µ–∫—Ç–∞
5. **–ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –†–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Supabase Storage Guide](https://supabase.com/docs/guides/storage)
- [Storage RLS Policies](https://supabase.com/docs/guides/storage/security/access-control)
- [CDN Integration Best Practices](https://developers.cloudflare.com/images/)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **Image Optimization**: Sharp, ImageMagick
- **Audio Processing**: FFmpeg, LAME
- **CDN**: Cloudflare Images, Bunny CDN
- **Monitoring**: Supabase Dashboard, Grafana

---

**–ê—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω**: 2025-12-03  
**–°–ª–µ–¥—É—é—â–∏–π –æ–±–∑–æ—Ä**: Sprint 010 Planning Meeting  
**–ö–æ–Ω—Ç–∞–∫—Ç**: GitHub Copilot Agent

