# ADR-011: Unified Studio Architecture - DAW Canvas Integration

## Status
**Accepted** (January 4, 2026)

## Context

MusicVerse AI Ğ¸Ğ¼ĞµĞµÑ‚ 3 Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚ÑƒĞ´Ğ¸Ğ¹Ğ½Ñ‹Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ğ¼ÑÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¾Ğ¼:

1. **StudioShell** (`src/components/studio/unified/`) â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ, Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ âœ…
2. **StemStudioContent** (`src/components/stem-studio/`) â€” legacy ÑÑ‚ÑƒĞ´Ğ¸Ñ Ñ Ğ±Ğ¾Ğ³Ğ°Ñ‚Ñ‹Ğ¼ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ¾Ğ¼
3. **MultiTrackStudioLayout** (`src/components/studio/MultiTrackStudioLayout.tsx`) â€” DAW-ÑÑ‚Ğ¸Ğ»ÑŒ Ñ drag-drop

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

- Ğ”ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ° Ğ¼ĞµĞ¶Ğ´Ñƒ ÑÑ‚ÑƒĞ´Ğ¸ÑĞ¼Ğ¸ (~40%)
- Ğ Ğ°Ğ·Ğ½Ñ‹Ğµ UX Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ² Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ…
- Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¸ Ñ‚Ñ€Ñ‘Ñ… Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¹
- ĞĞµĞ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚ Ñ Ñ‚Ğ°Ğ±Ğ°Ğ¼Ğ¸

### Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

- **Ğ‘ĞµĞ· Ğ´ĞµÑÑ‚Ñ€ÑƒĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ñ… Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹** â€” Ğ½Ğµ ÑƒĞ´Ğ°Ğ»ÑÑ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ ĞºĞ¾Ğ´
- **Ğ˜Ñ‚ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾
- **ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** â€” Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸Ğ· ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… ÑÑ‚ÑƒĞ´Ğ¸Ğ¹
- **Mobile-first** â€” Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²

## Decision

ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ» Ğ² **StudioShell** Ğ¸Ñ‚ĞµÑ€Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾, ÑĞ¾Ğ·Ğ´Ğ°Ğ² ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¹ DAW-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ:

### 1. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑƒĞ½Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸

```
StudioShell (Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€)
â”œâ”€â”€ ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸Ğ· stem-studio:
â”‚   â”œâ”€â”€ QuickCompare (A/B ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¹)
â”‚   â”œâ”€â”€ RemixDialog, ExtendDialog, TrimDialog
â”‚   â”œâ”€â”€ MixPresetsMenu
â”‚   â”œâ”€â”€ ReplacementProgressIndicator
â”‚   â””â”€â”€ DAWMixerPanel (Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¾Ğ²)
â”œâ”€â”€ DAW Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ· MultiTrackStudioLayout:
â”‚   â”œâ”€â”€ DAWTrackLane (drag-drop ĞºĞ»Ğ¸Ğ¿Ğ¾Ğ²)
â”‚   â”œâ”€â”€ TimelineRuler (BPM grid)
â”‚   â””â”€â”€ Playhead Ñ drag
â””â”€â”€ ĞĞ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:
    â”œâ”€â”€ MobileDAWTimeline (pinch-zoom, tap-seek)
    â”œâ”€â”€ AIActionsFAB (floating AI actions)
    â””â”€â”€ useUnifiedStudio hook
```

### 2. Ğ¤Ğ°Ğ·Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

| Ğ¤Ğ°Ğ·Ğ° | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ | Ğ’Ñ€ĞµĞ¼Ñ |
|------|----------|-------|
| 1 | Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸Ğ· StemStudio | 4Ñ‡ |
| 2 | DAW Timeline Enhancement | 6Ñ‡ |
| 3 | Mobile DAW Mode | 6Ñ‡ |
| 4 | Unified Effects & Mixer | 3Ñ‡ |
| 5 | State Consolidation | 3Ñ‡ |

### 3. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

#### Ğ˜Ğ· stem-studio (Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ, Ğ½Ğµ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ):
- `QuickCompare.tsx` â€” A/B/C ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¹
- `RemixDialog.tsx` â€” Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ€ĞµĞ¼Ğ¸ĞºÑĞ°
- `ExtendDialog.tsx` â€” Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ
- `TrimDialog.tsx` â€” Ğ¾Ğ±Ñ€ĞµĞ·ĞºĞ° Ñ‚Ñ€ĞµĞºĞ¾Ğ²
- `MixPresetsMenu.tsx` â€” Ğ¿Ñ€ĞµÑĞµÑ‚Ñ‹ Ğ¼Ğ¸ĞºÑĞ°
- `ReplacementProgressIndicator.tsx` â€” Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹
- `DAWMixerPanel.tsx` â€” Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ¼Ğ¸ĞºÑˆĞµÑ€Ğ° Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹

#### Ğ˜Ğ· MultiTrackStudioLayout (Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ):
- `MultiTrackTimeline` â†’ `DAWTrackLane`
- Drag-drop Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ»Ñ ĞºĞ»Ğ¸Ğ¿Ğ¾Ğ²

### 4. ĞĞ¾Ğ²Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```typescript
// src/hooks/studio/useUnifiedStudio.ts
export function useUnifiedStudio(options: {
  mode: 'track' | 'project';
  id: string;
}) {
  return {
    // Project/Track data
    project, tracks,
    // Playback
    isPlaying, play, pause, seek, currentTime, duration,
    // Track controls
    toggleMute, toggleSolo, setVolume, setPan,
    // AI Actions
    separateStems, replaceSection, addVocals, extend, cover,
    // Effects
    trackEffects, setTrackEffects,
    // History
    canUndo, canRedo, undo, redo,
    // Export
    exportMix, downloadStems,
  };
}
```

### 5. Mobile Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header: Name | AI | Menu        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Mini Track Overview (collapsed) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Expandable Timeline             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¤ Vocals     [M][S] â–¬â–¬â–¬â–¬â–¬ â”‚ â”‚
â”‚ â”‚ ğŸ¸ Instr.     [M][S] â–¬â–¬â–¬â–¬â–¬ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AI Quick Actions (FAB menu)     â”‚
â”‚ [âœ¨ Generate] [ğŸ”€ Extend] [ğŸ¤] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Transport: â—„â—„ | â–¶ | â–  | â–ºâ–º | Volâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Consequences

### Positive
- âœ… Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ² Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹
- âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
- âœ… ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
- âœ… Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ UX
- âœ… Ğ¡Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° 40%

### Negative
- âš ï¸ Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğµ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ (2 ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾)
- âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ğ¿ÑƒÑ‚ĞµĞ¹
- âš ï¸ ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹

### Neutral
- Ğ¡ÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ€Ğ¾ÑƒÑ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ÑÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ
- Legacy ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ ĞºĞ°Ğº fallback

## Implementation Plan

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| `src/components/studio/unified/DAWTrackLane.tsx` | Drag-drop lane |
| `src/components/studio/unified/TimelineRuler.tsx` | BPM grid ruler |
| `src/components/studio/unified/MobileDAWTimeline.tsx` | Mobile timeline |
| `src/components/studio/unified/AIActionsFAB.tsx` | AI actions FAB |
| `src/hooks/studio/useUnifiedStudio.ts` | Unified hook |

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

| Ğ¤Ğ°Ğ¹Ğ» | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ |
|------|-----------|
| `StudioShell.tsx` | Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ QuickCompare, TrimDialog, Progress |
| `MobileStudioLayout.tsx` | Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ MobileDAWTimeline |
| `StemEffectsDrawer.tsx` | Ğ£Ğ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ |

### Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ‘Ğ•Ğ— Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼)

- Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ² `src/components/stem-studio/`
- `src/stores/useStudioProjectStore.ts` (ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ)
- `src/components/studio/MultiTrackStudioLayout.tsx` (reference)

## Related Documents

- [SPRINT-030-UNIFIED-STUDIO-MOBILE.md](../SPRINTS/SPRINT-030-UNIFIED-STUDIO-MOBILE.md)
- [STEM_STUDIO.md](../docs/STEM_STUDIO.md)
- [KNOWLEDGE_BASE.md](../KNOWLEDGE_BASE.md)

---

**Author:** Lovable AI  
**Date:** 2026-01-04  
**Reviewers:** â€”
